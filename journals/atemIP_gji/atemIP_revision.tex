%gji_extra_guide.tex
% \documentclass{gji}
\documentclass[extra,mreferee]{gji}
\usepackage{times, color}
% \usepackage{mathrsfs,amsmath}
% \documentclass[a4paper, 11pt]{article}
% \usepackage{fullpage}
\usepackage[pdftex]{graphicx}
\usepackage{mathrsfs, amsmath, amsfonts,xspace}
\usepackage[pagewise, mathlines]{lineno}

% \usepackage{framed, color, fancybox}
\author[Seogi Kang and Douglas W. Oldenburg]
   {Seogi Kang and Douglas W. Oldenburg \\
    Department of Earth, Ocean and Atmospheric Sciences,
    University of British Columbia,
    B.C. \emph{V6T 1Z4}, Canada
  }

\title{On recovering distributed IP information from inductive source time domain electromagnetic data}


%% =============================================================================
%% My eqs
%% =============================================================================
\newcommand{\SimPEG}{\textsc{SimPEG}\xspace}
\renewcommand{\div}{\nabla\cdot}
\newcommand{\grad}{\vec \nabla}
\newcommand{\curl}{{\vec \nabla}\times}
\newcommand {\J}{{\vec J}}
\renewcommand{\H}{{\vec H}}
\newcommand {\E}{{\vec E}}
\newcommand{\siginf}{\sigma_\infty}
\newcommand{\dsig}{\triangle\sigma}
\newcommand{\dcurl}{{\mathbf C}}
\newcommand{\dgrad}{{\mathbf G}}
\newcommand{\Acf}{{\mathbf A_c^f}}
\newcommand{\Ace}{{\mathbf A_c^e}}
\renewcommand{\S}{{\mathbf \Sigma}}
\newcommand{\St}{{\mathbf \Sigma_\tau}}
\newcommand{\T}{{\mathbf T}}
\newcommand{\Tt}{{\mathbf T_\tau}}
\newcommand{\diag}{\mathbf{diag}}
\newcommand{\M}{{\mathbf M}}
\newcommand{\MfMui}{{\M^f_{\mu^{-1}}}}
\newcommand{\MfMuoi}{{\M^f_{\mu_0^{-1}}}}
\newcommand{\dMfMuI}{{d_m (\M^f_{\mu^{-1}})^{-1}}}
\newcommand{\dMfMuoI}{{d_m (\M^f_{\mu_0^{-1}})^{-1}}}
\newcommand{\MeSig}{{\M^e_\sigma}}
\newcommand{\MeSigInf}{{\M^e_{\sigma_\infty}}}
\newcommand{\MeSigInfEtab}{{\M^e_{\sigma_\infty \bar{\eta}}}}
\newcommand{\MeSigInfEtat}{{\M^e_{\sigma_\infty \peta}}}
\newcommand{\MedSig}{{\M^e_{\triangle\sigma}}}
\newcommand{\MeSigO}{{\M^e_{\sigma_0}}}
\newcommand{\Me}{{\M^e}}
\newcommand{\Js}{\mathbf{J}^s}
\newcommand{\Mes}[1]{{\M^e_{#1}}}
\newcommand{\Mee}{{\M^e_e}}
\newcommand{\Mej}{{\M^e_j}}
\newcommand{\BigO}[1]{\mathcal{O}\bigl(#1\bigr)}
\newcommand{\bE}{\mathbf{E}}
\newcommand{\bEp}{\mathbf{E}^p}
\newcommand{\bB}{\mathbf{B}}
\newcommand{\bBp}{\mathbf{B}^p}
\newcommand{\bEs}{\mathbf{E}^s}
\newcommand{\bBs}{\mathbf{B}^s}
\newcommand{\bH}{\mathbf{H}}
\newcommand{\B}{\vec{B}}
\newcommand{\D}{\vec{D}}
\renewcommand{\H}{\vec{H}}
\newcommand{\s}{\vec{s}}
\newcommand{\bfJ}{\bf{J}}
\newcommand{\vecm}{\vec m}
\renewcommand{\Re}{\mathsf{Re}}
\renewcommand{\Im}{\mathsf{Im}}
\renewcommand {\j}  { {\vec j} }
\newcommand {\h}  { {\vec h} }
\renewcommand {\b}  { {\vec b} }
\newcommand {\e}  { {\vec e} }
\renewcommand {\d}  { {\vec d} }
\renewcommand {\u}  { {\vec u} }

\renewcommand {\dj}  { {\mathbf{j} } }
\renewcommand {\dh}  { {\mathbf{h} } }
\newcommand {\db}  { {\mathbf{b} } }
\newcommand {\de}  { {\mathbf{e} } }

\newcommand{\vol}{\mathbf{v}}
\newcommand{\I}{\vec{I}}
\newcommand{\A}{\mathbf{A}}
\newcommand{\bI}{\mathbf{I}}
\newcommand{\bus}{\mathbf{u}^s}
\newcommand{\brhss}{\mathbf{rhs}_s}
\newcommand{\bup}{\mathbf{u}^p}
\newcommand{\brhs}{\mathbf{rhs}}
%%-------------------------------
\newcommand{\bon}{b^{on}(t)}
\newcommand{\bp}{b^{p}}
\newcommand{\dbondt}{\frac{db^{on}(t)}{dt}}
\newcommand{\dfdt}{\frac{df(t)}{dt}}
\newcommand{\dfdtdsiginf}{\frac{\partial\frac{df(t)}{dt}}{\partial\siginf}}
\newcommand{\dfdsiginf}{\frac{\partial f(t)}{\partial\siginf}}
\newcommand{\dbgdsiginf}{\frac{\partial b^{Impulse}(t)}{\partial\siginf}}
\newcommand{\digint}{\frac{2}{\pi}\int_0^{\infty}}
\newcommand{\Gbiot}{\mathbf{G}_{Biot}}
%%-------------------------------
\newcommand{\peta}{\tilde{\eta}}
\newcommand{\eFmax}{\e^{\ F}_{max}}
\newcommand{\eref}{\e^{\ ref}}
\newcommand{\jref}{\j^{\ ref}}
\newcommand{\dip}{d^{IP}}
\newcommand{\sigpert}{\delta\sigma}
\newcommand{\bzip}{b_z^{IP}}
\newcommand{\dbzdtip}{\frac{\partial b_z^{IP}}{\partial t}}


\begin{document}

\label{firstpage}

\maketitle



% Key words:
% Geomagnetic induction,
% Electromagnetic theory,
% Electrical properties,
% Numerical approximations and analyses

\begin{summary}
We develop a procedure to invert time domain induced polarization (IP) data for inductive sources. Our approach is based upon the inversion methodology in conventional electrical IP (EIP), which uses a sensitivity function that is independent of time. However, significant modifications are required for inductive source IP (ISIP) because electric fields in the ground do not achieve a steady state. The time-history for these fields needs to be evaluated and then used to define approximate IP currents. The resultant data, either a magnetic field or its derivative, are evaluated through the Biot-Savart law. This forms the desired linear relationship between data and pseudo-chargeability.
Our inversion procedure has three steps:
1) Obtain a 3D background conductivity model. We advocate, where possible, that this be obtained by inverting early-time data that do not suffer significantly from IP effects.
2) Decouple IP responses embedded in the observations by forward modelling the TEM data due to a background conductivity and subtracting these from the observations. 3) Use the linearized sensitivity function to invert data at each time channel and recover pseudo-chargeability. Post-interpretation of the recovered pseudo-chargeabilities at multiple times allows recovery of intrinsic Cole-Cole parameters such as time constant and chargeability. The procedure is applicable to all inductive source survey geometries but we focus upon airborne time domain EM (ATEM) data with a coincident-loop configuration because of the distinctive negative IP signal that is observed over a chargeable body.
Several assumptions are adopted to generate our linearized modelling but we systematically test the capability and accuracy of the linearization for ISIP responses arising from different conductivity structures. On test examples we show: (a) our decoupling procedure enhances the ability to extract information about existence and location of chargeable targets directly from the data maps; (b) the horizontal location of a target body can be well recovered through inversion; (c) the overall geometry of a target body might be recovered but for ATEM data a depth weighting is required in the inversion; (d)  we can recover estimates of intrinsic $\tau$ and $\eta$ that may be useful for distinguishing between two chargeable targets.
\end{summary}

%%=====================================================================
%% Section. Intro.
%%=====================================================================

\linenumbers
\section{Introduction}
The electrical conductivity of earth materials can be frequency dependent with the effective conductivity decreasing with decreasing frequency due to the buildup of electric charges that occur under the application of an electric field. Effectively, the rock is electrically polarized.
Applications of induced polarization (IP) surveys to find chargeable material  have been particularly successful in mineral exploration for disseminated sulphide or porphyry deposits \cite[]{Pelton1978, Fink1990} and also in geotechnical and environmental problems \cite[]{Li2000,Kemna2012}.

Polarization charges can accumulate whenever there is an electric field in a medium. In controlled source surveys, the transmitter can be a galvanic source (a generator attached to two grounded electrodes), or an inductive source (arising from currents flowing in a wire loop). Most research and application has focused upon using grounded electrodes and measuring electric fields; this is called an EIP survey \cite[]{seigel1959}. Magnetic fields arising from polarization currents using grounded electrodes as the transmitter (MIP survey) have also been successfully used, particularly in mineral exploration when there is a conductive overburden \cite[]{seigel1974}. In recent years attention has also turned towards the use of inductive sources. Inductive source IP (ISIP), can have transmitters in the air or on the ground and the waveforms can be in the frequency or time domain. Recently  \cite[]{Marchant2012b} showed how, by collecting data at two frequencies, it was possible to measure data that depended purely on IP signals and that these data can be inverted to recover a 3D distribution of chargeability.
For time domain systems, the observations of negative transients in coincident-loop systems provide an distinctive verification of the existence of chargeable material \cite[]{Weidelt1982}. These negative transients have been frequently observed \cite[]{SmithandKlein,Kang2015a}. The effects of chargeable objects using time domain systems with inductive sources have been investigated \cite[]{Smith1988a,Flis1989,ElKaliouby2004, Marchant2014} and approximate interpretation tools \cite[]{Kratzer2012,Hodges2014} are being developed. The ability to fully invert these data in 3D is still lacking.

Extracting information about the complex conductivity from observed data can be done in a variety of ways. An inverse problem can be set up to find a function $\sigma(x,y,z,\omega)$ or a parameterization of the complex conductivity, usually with a Cole-Cole type model, \cite[]{Fiandaca2012, Marchant2013,Xu2013}. Traditionally, however, with EIP and time domain waveforms, one first estimates the background conductivity from the asymptotic on-time data and then inverts off-time data to recover information about ``chargeability'' \cite[]{doug1994}. This is carried out by solving an inverse problem using a linear function where the sensitivities depend upon geometry of the survey and the background conductivity. The recovered values are really pseudo-chargeability, and they have the same units as the data (eg. msec, mV/V). The same procedure can be used in the frequency domain experiments but the data might have units of mrad and pfe (percent frequency effect). Inversions of IP data to recover 2D or 3D distributions of pseudo-chargeability are now commonly carried out \cite[]{Kemna2012}. These inversions delineate locations of high pseudo-chargeability and the geometry of the bodies. MIP data can be inverted with the same methodology \cite[]{Chen2003}. We note that pseudo-chargeabilty is different from intrinsic chargeability, $\eta$, where $\eta = \frac{\siginf-\sigma_0}{\siginf}$ and $\siginf$ and $\sigma_0$ are repectively the conductivity at the infinite frequency and the zero frequency.

The physical mechanisms by which polarization charges and currents are established in the ground are independent of the type of transmitter and waveform; the important quantity is the time history of the electric field within the earth. The challenge posed by the use of inductive sources is that steady state electric fields are not established inside the earth as they are for EIP or MIP surveys. At any location in the earth the electric field will increase to a maximum value and then decrease as the electromagnetic (EM) wave diffuses through. The EM fields at any position and time depend upon the convolution of the electric field with the time-dependent conductivity of the rock. Unravelling these complexities, and providing a framework for extracting information about IP characteristics of rocks, are issues we address in our paper.

Our procedure involves three principal steps: 1) estimating the 3D background conductivity and carrying out an EM-decoupling to produce IP data ($\dip$), and 2) developing a linearized formulation using the Biot-Savart law and an effective pseudo-chargeability that encapsulates time dependencies of the EM fields at any location in the earth, 3) inverting $\dip$ using the linear functional to recover pseudo-chargeability at each time channel, and subsequently processing these multi-channel data to obtain information about Cole-Cole parameters for each point in the subsurface. Each of these steps requires special attention for inductive source data and approximations are required.
Our paper proceeds as follows. We first outline our decomposition process for obtaining $\dip$ data, define a pseudo-chargeability, and show how our problem can be linearized.
%For ATEM surveys with multiple transmitters, we show how to generate a single linear inverse problem that can be solved for an effective pseudo-chargeability.
The IP data and  pseudo-chargeability are linearly related through the Biot-Savart law and hence a depth weighting, required for other potential field inversions, is necessary to obtain geologically meaningful solutions. The inversion can be carried out at multiple times and a pseudo-chargeability as a function of time can be generated. These results can be used to recover intrinsic decays of the chargeable rock units and thus potentially differentiate between rock types in the same manner as carried out by \cite{Yuval1997} using EIP data. In our numerical experiments, we investigate the above steps and procedures, test our assumptions, and evaluate the circumstances under which our technique might provide meaningful results. Although  we focus upon airborne TEM data, the analysis we present here is valid for surveys on the earth’'s surface using inductive sources and also for grounded sources although many of the complications we deal with are not relevant.

%%=====================================================================
%% Section. Complex conductivity
%%=====================================================================

\section{Complex conductivity}
A complex conductivity model presents a mathematical form of the IP phenomenon, and there are a number of models used in the literautre \cite[]{Dias2000,Tarasov2013}. Each model has some reflection of an IP phenomenon, and each of these models is an attempt to capture the complicated nature of complex conductivity with a few parameters that may, or may not, have a physical meaning. For our research we needed to choose one. We follow \cite{Smith1988a} and \cite{Marchant2014} who used a Cole-Cole model \cite[]{COLE} modified by \cite{Pelton1978}:
\begin{linenomath*}
\begin{equation}
  \sigma(s) = \sigma_{\infty} - \sigma_{\infty}\Big(\frac{\eta}{1+(1-\eta)(s \tau)^c}\Big) = \sigma_{\infty} + \triangle\sigma(s),
  \label{eq: sigma_freq}
\end{equation}
\end{linenomath*}
where $s$ is the Laplace transform variable, $\sigma_{\infty}$ is the conductivity at infinite frequency, $\eta$ is the intrinsic chareability, $\tau$ is the time constant and $c$ is the frequency dependency.

% Assuming that the input current of a TEM survey is a half-duty cycle then, right after the current switch-off, observed signals are mostly affected by $\sigma_{\infty}$ (TEM conductivity), and at this time observed signals are dominantly due to induced EM signals.
% As time passes charging and discharging of polarization charges simultaneously occur, and at late enough time observed signals could be mostly affected by IP signals.
% Hence, only early TEM signals, which are not considerably contaminated by IP, could be explained without time-dependent conductivity, and the most proper conductivity for those signals is $\siginf$.
% This is the reason why we expressed the Cole-Cole conductivity shown in eq. \ref{eq: sigma_freq} in terms of $\siginf$ different from the usual expression using $\sigma_0$ (DC conductivity).

Real and imaginary parts of complex conductivity in the frequency domain are shown in Fig. ~\ref{Fig:FDandTDCole}(a) for Cole-Cole parameters: $\siginf$ = $10^{-2}$ S/m, $\eta $ = 0.5, $\tau$ = 0.01s, and $c$=1.
% Since we are interested in IP signals in the time domain, identifying the Cole-Cole conductivity in time can be insightful.
By applying the inverse Laplace transform, we have
\begin{linenomath*}
\begin{equation}
  \sigma(t) = \mathscr{L}^{-1}[\sigma(s)] = \sigma_{\infty}\delta(t) + \triangle\sigma(t),
  \label{eq: sigma_time}
\end{equation}
\end{linenomath*}
where $\delta(t)$ is Dirac delta function, and $\mathscr{L}^{-1}[\cdot]$ is inverse Laplace transform operator. Note that we only deal with a causal function, which is defined when $t\ge 0$.

The intrinsic chargeability $\eta$ is
\begin{linenomath*}
\begin{equation}
  \eta= -\frac{1}{\siginf} \lim_{t \to \infty}\mathscr{L}^{-1}[\frac{\dsig(s)}{s}]
  % \eta= \frac{\dsig(0)}{\siginf}.
\end{equation}
\end{linenomath*}
Accordingly, it is convenient to define an impulse pseudo-chargeability, $\peta^{I}(t)$ as
\begin{linenomath*}
\begin{equation}
    \peta^{I}(t) = -\frac{\dsig(t)}{\siginf}. %=\frac{\eta}{(1-\eta)\tau}e^{-\frac{t}{(1-\eta)\tau}}u(t)
    \label{eq: intrinsic_peta}
\end{equation}
\end{linenomath*}
Effectively this writes $\dsig(t)$ as
\begin{linenomath*}
\begin{equation}
  \dsig(t) = - \siginf\peta^{I}(t),
  \label{eq: sigma_time_c1}
\end{equation}
\end{linenomath*}
Note that the intrinsic chargeability, $\eta$, is not time-dependent but the impulse pseudo-chargeability, $\peta^{I}(t)$, which is related to IP parameters: $\eta$, $\tau$, and $c$, is time-dependent.
The Cole-Cole response in time domain is shown in Fig. ~\ref{Fig:FDandTDCole}(b). The arrow at $t$=0 s indicates $\siginf \delta(t)$, which is a delta function, and after $t$=0 s, $\sigma (t) = \dsig(t)$. Since Ohm's law in time states that $\j=\sigma \otimes \e$ where $\otimes$ indicates convolution, the negative sign of $\dsig(t)$ shows that the polarization current in the chargeable body will have a reversed direction compared to the primary current when an electric field is applied. We will revisit this later in Section ~\ref{section: pseudo-chargeability}.

%%=====================================================================
%% Section. Decomposition of observed responses
%%=====================================================================

\section{Decomposition of observed responses}
IP effects in the observed data are coupled with EM effects. We need to decompose the observations to isolate data associated only with the IP phenomena.
Maxwell's equations in the time domain, with a quasi-static approximation, are written as:
\begin{linenomath*}
\begin{equation}
  \curl{\e} = -\frac{\partial \b}{\partial t},
  \label{eq: total_farad}
\end{equation}
\end{linenomath*}
\begin{linenomath*}
\begin{equation}
  \curl{\frac{1}{\mu}\b} - \j= \j_{s},
  \label{eq: total_coulomb}
\end{equation}
\end{linenomath*}
where $\e$ is the electric field ($V/m$), $\b$ is the magnetic flux density ($Wb/m^2$), $\j_{s}$ is the current source ($A/m^2$) and $\mu$ is the magnetic permeability ($H/m$). Here $\j$ is the conduction current ($A/m^2$). In the frequency domain, this conduction current, $\J$, is related to conductivity via Ohm’s law: $\J(s) = \sigma(s)\E(s)$ where $\E$ is the electric field.
Converting this relationship to time domain using the inverse Laplace transform yields:
\begin{linenomath*}
\begin{equation}
  \j(t) = \sigma \otimes \e = \int_0^t \sigma(u) e(t-u) du.
  \label{eq: ohms_law_convolution}
\end{equation}
\end{linenomath*}
% where $\otimes$ indicates time convolution for a causal signal.
Thus the current density depends upon the previous history of the electric field.
As in \cite{Smith1988a}, we represent total fields as $\e = \e^{F} + \e^{\ IP}$, $\b = \b^{F} + \b^{IP}$ and $\j = \j^{F} + \j^{IP}$, where superscript $F$ indicates fundamental and $IP$ is induced polarization.
Here fundamental fields indicate EM fields when the chargeability is zero . Thus  $\sigma(s) = \siginf$  (eq. \ref{eq: sigma_freq}) and there are no IP effects.

Equations (\ref{eq: total_farad}) and (\ref{eq: total_coulomb}) are written as
\begin{linenomath*}
\begin{equation}
  \curl({\e^{F}+\e^{\ IP}}) = -\frac{\partial}{\partial t} (\b^{F}+\b^{IP}),
\end{equation}
\end{linenomath*}
\begin{linenomath*}
\begin{equation}
  \curl\frac{1}{\mu}(\b^{F}+\b^{IP}) - (\j^{F}+\j^{IP})= \j_{s}.
\end{equation}
\end{linenomath*}

The fundmental equations can be written as
\begin{linenomath*}
\begin{equation}
  \curl \e^{F} = -\frac{\partial \b^{F}}{\partial t},
  \label{eq: eq_primary_farad}
\end{equation}
\end{linenomath*}
\begin{linenomath*}
\begin{equation}
  \curl{\frac{1}{\mu}\b^{F}} -\j^{F} = \j_s.
  \label{eq: eq_primary_coulomb}
\end{equation}
\end{linenomath*}
where
\begin{linenomath*}
\begin{equation}
  \j^{F} = \siginf\e^{F}.
  \label{eq: jF}
\end{equation}
\end{linenomath*}

Subtraction of the fundamental fields yields the expressions for the IP fields
\begin{linenomath*}
\begin{equation}
  \curl \e^{\ IP} = -\frac{\partial \b^{IP}}{\partial t},
  \label{eq: eq_secondary_farad}
\end{equation}
\end{linenomath*}
\begin{linenomath*}
\begin{equation}
  \curl{\frac{1}{\mu}\b^{IP}} = \j^{IP}.
  \label{eq: eq_secondary_coulomb}
\end{equation}
\end{linenomath*}

Let $F[\cdot]$ denote the operator associated with Maxwell’s equations, and let $d$ denote the observations that include both EM and IP effects.
Keeping the same notation, we obtain $d = d^{F} + \dip$, where $d^F$ and $\dip$ are fundamental and IP responses, respectively.
Based on this, we define the IP datum as
\begin{linenomath*}
\begin{equation}
  \dip = d - d^{F} = F[\sigma(t)]-F[\siginf].
    \label{eq: IPdatum_syn}
\end{equation}
\end{linenomath*}
Here $F[\siginf]$ corresponds to the fundamental response ($d^F$).
This subtraction acts as an EM-decoupling process which removes the EM effects from the measured responses. This is the same procedure that formed the basis of work by \cite{routh2001}.

%%=====================================================================
%% Section. Pseudo-chargeability
%%=====================================================================
\section{Pseudo-chargeability}
\label{section: pseudo-chargeability}
%% later
% A major difference of the inductive source from the galvanic source is the absence of the steady-state electric field.
% This generates a principal difference on the IP response for both inductive and galvanic sources.
% To examine this, we define the IP current ($\j^{IP}$) as
Writing
\begin{equation}
  \j^{IP} = \j(t) - \j^F
  \label{eq:jIP}
\end{equation}
and using eqs (\ref{eq: sigma_time}) and  (\ref{eq: ohms_law_convolution})  we obtain
\begin{linenomath*}
\begin{equation}
  \j^{IP} = \siginf \e^{\ IP} + \j^{pol},
  \label{eq:IP_current}
\end{equation}
\end{linenomath*}
where the polarization current ($\j^{pol}$) is
\begin{linenomath*}
\begin{equation}
  \j^{pol}(t) = \dsig(t) \otimes \e(t).
  \label{eq:polarization_current}
\end{equation}
\end{linenomath*}

If the electric field has different characteristics for the inductive and galvanic sources this will generate different features in the polarization current.
We consider two cases: a) a DC source with grounded electrodes (no EM induction) and b) an inductive source. The first case corresponds to usual approaches for interpreting EIP data \cite[]{seigel1959, doug1994}, and the second is associated with ISIP.
Fig. \ref{F:DCEM_F_current} shows the amplitude of the fundamental electric field, $\e^{F}$, in the earth for those two cases.
For the galvanic source without EM induction effects ($\frac{\partial \b}{\partial t}=0$), the electric field is instantaneously on or off in response to the transmitter. (Fig. \ref{F:DCEM_F_current} a).
However, for the inductive source, the electric field in the off-time is not zero, but increases to a peak and then decays as shown in Fig. \ref{F:DCEM_F_current} (b).
The polarization current for the two sources will be significantly affected by these different electric fields.
To capture this difference in a linearized kernel for the IP response, we define pseudo-chargeability, $\peta(t)$, as
\begin{linenomath*}
\begin{equation}
  \peta(t) = -\frac{\j^{pol}(t)}{\j^{\ ref}},
  \label{eq:pseudochargeability_0}
\end{equation}
\end{linenomath*}
where the reference current, $\j^{ref}$ is defined as
\begin{linenomath*}
\begin{equation}
  \j^{\ ref} = \siginf \eref.
  \label{eq:reference_current}
\end{equation}
\end{linenomath*}
Here $\eref$ is the reference electric field, and we will explain our choice of $\eref$ below.
The pseudo-chargeability defined in eq. (\ref{eq:pseudochargeability_0}) is the ratio of  the polarization current to the reference current. This is a small quantity and it plays an essential role in our linearization.
To evaluate the pseudo-chargeability, we need to identify a reference current or reference electric field, $\eref$, which is independent of time. For EIP, we choose the value of the electric field achieved when there is no IP present, that is the value shown  in Fig. \ref{F:DCEM_F_current}(a). For the inductive source  we choose the peak electric field as shown in Fig. \ref{F:DCEM_F_current}(b)

Each pixel in the earth has its own reference electric field and time thus  both $\eref$ and $t^{\ ref}$ have a 3D distribution.
For both EIP and ISIP cases, we mathematically present our choice of the reference electric field as
\begin{linenomath*}
\begin{equation}
  \eref = \e^{F}(t) \otimes \delta(t-t^{\ ref}).
  \label{eq:reference_electricfield}
\end{equation}
\end{linenomath*}
The reference time for the EIP case can be any time in the on-time. By rearranging eq. (\ref{eq:pseudochargeability_0}), we obtain
\begin{linenomath*}
\begin{equation}
  \j^{pol} = -\jref\peta(t).
  \label{eq:polarization_current_concept}
\end{equation}
\end{linenomath*}
This states that the polarization current has an opposite direction to the reference current, and is proportional to the pseudo-chargeability.
This reversed direction of the current in a chargeable medium results from the negative values of the time-dependent conductivity when $t>$0 sec as shown in Fig. ~\ref{Fig:FDandTDCole}(b).
This conceptual model about the polarization current shown in eq. (\ref{eq:polarization_current_concept}) is consistent with \cite{seigel1959}'s result. We note, that for any pixel, even if  $\eref$  attains the same value for an ISIP survey as for an EIP survey, the pseudo-chargeability resulting from an ISIP survey will be less than that from an EIP survey. We can infer from this that linearization techniques, which have worked so well in EIP problems, should be successful in ISIP problems.

%% ============================================================
%% Section. Linearization
%% ============================================================
\section{Linearization}
Following from the methodologies in EIP, our goal is to express the IP response, $\dip$, as a linear function of the pseudo-chargeability,  $\peta(t)$. That is we wish to write $\dip(t) = J[\peta(t)]$, where $J[\cdot]$ is a linear operator which is independent of time. In doing this we first consider a general EM system which is applicable to galvanic or inductive sources.
For any volume pixel in the earth the amplitude and direction of the  electric field can vary dramatically in time and thus the IP charging process can be complicated. However, if substantial polarization currents are developed we assume there was a sufficiently large electric field in a predominant direction to generate them. Although the direction of the electric field is constant the amplitude varies with time.
% We choose the direction for which the electric field achieved its maximum value. will correspond to an electric field that  aligned in a constant direction. Our formulation focuses on this aspect.

% We assume that the final large-scale IP response observed in the data is the result of  pixels being charged with an electric field in a specific direction but with a variable amplitude.

Let $\e(t)$ be approximated as
\begin{linenomath*}
\begin{equation}
  \e(t) \approx \eref \hat{w}(t),
  \label{eq: e_with_eref}
\end{equation}
\end{linenomath*}
where $\hat{w}(t)$ is defined as:
\begin{linenomath*}
\begin{equation}
  \hat{w}(t) = P_0[w^{ref}(t)].
  \label{eq: we}
\end{equation}
\end{linenomath*}
Here a projection $P_0[\cdot]$ of an arbitrary time function, $f(t)$ is
\begin{linenomath*}
\begin{equation}
  P_0[f(t)] = \left\{
  \begin{array}{l l}
    f(t) & f(t) \ge 0 \\
    0 & \text{if } f(t) < 0,
  \end{array}\right.
  \label{eq: P0}
\end{equation}
\end{linenomath*}
and
\begin{linenomath*}
\begin{equation}
  w^{ref}(t) = \frac{\e^F(t)\cdot\eref}{\eref\cdot\eref}.
  \label{eq: wref}
\end{equation}
\end{linenomath*}
$w^{ref}(t)$ is a dimensionless function that prescribes the time history of the electric field at each location along the direction of the chosen reference electric field, $\eref$.  Negative values of  $w^{ref}(t)$ are set to zero in accordance with our conceptual model that polarization currents have an opposite direction to the reference current (eq. \ref{eq:polarization_current_concept}).
We redefine the pseudo-chargeability as
\begin{linenomath*}
\begin{equation}
    \peta(t) = \peta^{I}(t)\otimes \hat{w}(t).
    \label{eq: pseudochargeability}
\end{equation}
\end{linenomath*}
The polarization current, $\j^{pol}$, can be approximated with eq. (\ref{eq: intrinsic_peta}) as
\begin{linenomath*}
\begin{equation}
  \j^{pol}(t) \approx - \peta^{I}(t)\otimes \hat{w}(t)\jref.
\end{equation}
\end{linenomath*}
Substituting into eq. (\ref{eq:IP_current}) yields
\begin{linenomath*}
\begin{equation}
  \j^{IP}(t) \approx \siginf\e^{\ IP}(t) - \peta^{I}(t)\otimes \hat{w}(t)\jref
\end{equation}
\end{linenomath*}
and this yields
\begin{linenomath*}
\begin{equation}
  \j^{IP}(t) \approx \siginf\e^{\ IP}(t) -\jref\peta(t).
  \label{eq: jip_EMIP}
\end{equation}
\end{linenomath*}

The second term, $-\jref\peta(t)$ corresponds to polarization currents. The first term, $\siginf \e^{\ IP}(t)$ is usually omitted \cite[]{Smith1988a}. This was because \cite{Smith1988a} were mostly interested in chargeable targets that were significantly conductive compared to the background. However, if the conductivity of the chargeable target is similar to that of the background, the first term could be important.

We include it here and will explore the conditions in which it is important.
Because the reference current is static, any time-dependence in the polarization currents is encapsulated in the pseudo-chargeability. The buildup and decrease of polarization currents is a slow process and we assume therefore that this process does not produce induction effects ($\frac{\partial \b^{IP}}{\partial t} \approx 0$) and hence we can write
\begin{linenomath*}
\begin{equation}
  \e^{\ IP} \approx  \e^{\ IP}_{approx} = -\grad\phi^{IP},
  \label{eq: eip_approx}
\end{equation}
\end{linenomath*}
where $\phi^{IP}$ is the electrical potential for IP.
By taking the divergence of  eq. (\ref{eq: jip_EMIP}), substituting  $\e^{\ IP}$ with eq. (\ref{eq: eip_approx}), and carrying out some linear algebra, we obtain
\begin{linenomath*}
\begin{equation}
  \phi^{IP}(t) \approx -[\div \siginf\grad]^{-1}\div\jref\peta(t).
  \label{eq: phiIPapprox_general}
\end{equation}
\end{linenomath*}
By applying the gradient we obtain
\begin{linenomath*}
\begin{equation}
    \e^{\ IP}_{approx} = \grad[\div \siginf\grad]^{-1}\div\jref\peta(t).
    \label{eq: eip_approx_full}
\end{equation}
\end{linenomath*}
Thus, the electric field due to the IP effect can be expressed as a function of $\peta(t)$ in time.
This form is also applicable to the  EIP case.

For an inductive source, the data are either $\b$ or its time derivative and hence we also need to compute $\b^{IP}$ or its time derivative.
For this, we first compute $\j^{IP}$ then use the Biot-Savart law.
By substituting eq. (\ref{eq: eip_approx_full}) into eq. (\ref{eq: jip_EMIP}), the approximated IP current density, $\j^{IP}_{approx}$ can be expressed as
\begin{linenomath*}
\begin{equation}
  \j^{IP}(t) \approx \j^{IP}_{approx} = \bar{S}\jref\peta(t),
  \label{eq: jip_approx}
\end{equation}
\end{linenomath*}
where
\begin{linenomath*}
\begin{equation}
  \bar{S} = \siginf\grad[\div \siginf\grad]^{-1}\div-\bar{I}
\end{equation}
\end{linenomath*}
and $\bar{I}$ is an identity tensor.
Applying the Biot-Savart law we have:
\begin{linenomath*}
\begin{equation}
  \b^{IP}_{approx}(\vec{r}; t) = \frac{\mu_0}{4\pi}\int_{\Omega}  \frac{\bar{S}\j^{\ ref}(\vec{r}_s)\times\hat{r}}{|\vec{r}-\vec{r}_s|^2}\peta(t)d\vec{r}_s,
  \label{eq: BiotbIP_approx}
\end{equation}
\end{linenomath*}
where $\vec{r}_s$ indicates a vector for a source location, and $\hat{r}=\frac{\vec{r}-\vec{r}_s}{|\vec{r}-\vec{r}_s|}$.
If $\siginf\e^{\ IP}$ is omitted in  $\j^{IP}$ then the tensor, $\bar{S}$ becomes $-\bar{I}$.
In this situation, the IP current is same as the polarization current, and it always has an opposite direction to the reference current.
This reversed current, along with Biot-Savart law,  provides a physical understanding about the negative transients in ATEM data when the earth is chargeable.

Observed data are often the time derivative of $\b$, hence by taking time derivative to the eq. (\ref{eq: BiotbIP_approx}), we obtain
\begin{linenomath*}
\begin{equation}
  -\frac{\partial\b^{IP}_{approx}}{\partial t}(\vec{r}; t) = \frac{\mu_0}{4\pi} \int_{\Omega}  \frac{\bar{S}\jref(\vec{r}_s)\times\hat{r}}{|\vec{r}-\vec{r}_s|^2} \Big( -\frac{\partial \peta(t)}{\partial t} \Big) d\vec{r}_s.
  \label{eq: BiotbIPdt_approx}
\end{equation}
\end{linenomath*}
Here we have chosen to keep the minus signs in eq. (\ref{eq: BiotbIPdt_approx}) so that $-\frac{\partial \peta(t)}{\partial t}$ is positive when $\peta(t)$ is decaying in time.
Accordingly, the IP datum is given by  $-\frac{\partial\b^{IP}}{\partial t}$.

The IP fields shown in eqs (\ref{eq: eip_approx_full}), (\ref{eq: BiotbIP_approx}) and (\ref{eq: BiotbIPdt_approx}) are linear functionals of $\peta$ and the equations for a single time channel can be discretized in space as
\begin{linenomath*}
\begin{equation}
  \mathbf{d}^{IP} = \mathbf{J}\peta,
  \label{eq: dIP_lineareq}
\end{equation}
\end{linenomath*}
where $\mathbf{J}$ is the corresponding sensitivity matrix.
In particular when the observed datum is the time derivative of $\b$, the linear relationship can be written as
\begin{linenomath*}
\begin{equation}
  \mathbf{d}^{IP} = \mathbf{J}(-\frac{\partial \peta}{\partial t}\Big).
  \label{eq: dIP_lineareq_dbdt}
\end{equation}
\end{linenomath*}
A detailed description for the discretization of the linearized kernel is shown in Appendices \ref{section:maxwell_discrete} and \ref{section:linearkernel_discrete}.
The representation in eq. (\ref{eq: dIP_lineareq}) is valid for galvanic and inductive sources but the two assumptions: a) $\e \approx \eref \hat{w}(t)$ and b) $\e^{\ IP} \approx -\grad\phi^{IP}$ need to be tested numerically for the case of inductive sources.

%% ============================================================
%% Section. IP inversion methodology
%% ============================================================

\section{3D IP inversion methodology}

For the inversion of ISIP data, we focus on an ATEM survey with a coincident-loop geometry.
From the previous section, we first defined the IP datum (eq. ~\ref{eq: IPdatum_syn}) then linearized it as a function of the pseudo-chargeability (eq. ~\ref{eq: dIP_lineareq}). The linearization was developed for a single transmitter. An ATEM survey however includes many transmiters and each will excite a volumetric pixel differently. We address this important issue in Appendix \ref{subsection: Handling multiple transmitters in ATEM surveys}. It requires combining the pseudo-chargeabilites that arise from individual transmitters into a transmitter-independent effective pseudo-chargeabilty. This requires computing, and combining, the individual time histories of the electric fields due to each transmitter into an effective time history. The result is that a $\dip$ datum for any transmitter takes the form:
\begin{linenomath*}
\begin{equation}
  \left[ \begin{array}{c} \mathbf{d}^{IP}_1(t) \\ \mathbf{d}^{IP}_2(t) \\ \vdots \\
  \mathbf{d}^{IP}_{nTx}(t) \end{array} \right] = \left[\begin{array}{c} \mathbf{J}_1 \\ \mathbf{J}_2 \\ \vdots \\  \mathbf{J}_{nTx} \end{array}\right] \left[ \begin{array}{c} \mathbf{\peta}(t) \end{array} \right],
  \label{eq:EffectivePetaMatVec}
\end{equation}
\end{linenomath*}
where $\mathbf{d}^{IP}_k (t)$ and $\mathbf{J}_k$ indicates the IP datum and sensitivity matrix at $k$-th transmitter. Here $\peta(t)$ stands for an effective pseudo-chargeability, which represents pseudo-chareability from all transmitters. Hence, for a given effective pseudo-chargeability we can compute IP responses at all transmitters.
Eq. \ref{eq:EffectivePetaMatVec} shows that IP data for an ATEM survey are linearly related to effective pseudo-chargeability. Information about chargeability can be obtained by solving a linear inverse problem. This is a common problem in applied geophysics so we provide only an essential summary.


%% ============================================================
%%% SUBSECTION
\subsection{3D IP inversion with a linearized kernel}
The linear inverse problem to recover chargeability is straightforward and is described in \cite{doug1994}.
We rewrite eq. (\ref{eq: dIP_lineareq}) as
\begin{linenomath*}
\begin{equation}
  \mathbf{d}^{pred} = \mathbf{J}\mathbf{m},
  \label{eq9}
\end{equation}
\end{linenomath*}
where $\mathbf{J}$ is the  sensitivity matrix of linear problem, which corresponds to $\mathbf{J}$ shown in eq. (\ref{eq: dIP_lineareq}).
Here, $\mathbf{d}^{pred}$ represents IP responses at a single time channel, $\mathbf{m}$ denotes model parameters, which can be either $\peta$ or $-\frac{\partial \peta}{\partial t}$. The important positivity constraint results because the intrinsic chargeabilty $\eta$ is resctricted to the range [0,1).

The solution to the inverse problem is the model $\mathbf{m}$ that solves the optimization problem
\begin{linenomath*}
\begin{equation}
  minimize \ \phi =  \phi_d(\mathbf{m}) + \beta\phi_m(\mathbf{m}) \\
  \label{eq10}
\end{equation}
\begin{equation}
  s.t. \ 0 \le \mathbf{m}, \nonumber
\end{equation}

\end{linenomath*}
where $\phi_d$ is a measure of data misfit, $\phi_m$ is a user-defined model objective function and $\beta$ is regularization or trade-off parameter.

We use the sum of the squares to measure data misfit
\begin{linenomath*}
\begin{equation}
  \phi_d = \| \mathbf{W_d}(\mathbf{A}\mathbf{m}-d^{obs}|)\|^2_2 =
  \sum^N_{j=1}(\frac{d^{pred}_j-d^{obs}_j}{\epsilon_j})^2,
  \label{eq11}
\end{equation}
\end{linenomath*}
where $N$ is the number of the observed data and $\mathbf{W_d}$ is a diagonal data weighting matrix which contains the reciprocal of the estimated uncertainty of each datum ($\epsilon_j$) on the main diagonal,  $\mathbf{d}^{obs}$ is a vector containing the observed data, $\mathbf{d}^{pred}$ is a vector containing calculated data from a linear eq. given in eq. (\ref{eq9}).
The model objective function, $\phi_m$, is a measure of the amount structure in the model and upon minimization this will generate a smooth model which is close to a reference model, $m_{ref}$.
We define $\phi_m$ as
\begin{linenomath*}
\begin{equation}
  \phi_m = \sum_{i=s,x,y,z} \alpha_i\| \mathbf{W}_i\mathbf{W}(\mathbf{m}-\mathbf{m}_{ref})\|^2_2,
  \label{eq12}
\end{equation}
\end{linenomath*}
where $\mathbf{W}$ is a model weighting matrix, which will be defined below, $\mathbf{W}_s$ is a diagonal matrix containing volumetric information of prisms, and $\mathbf{W}_x$, $\mathbf{W}_y$ and $\mathbf{W}_z$ are discrete approximations of the first derivative operator in $x$, $y$ and $z$ directions, respectively.
The $\alpha$'s are weighting parameters that balance the relative importance of producing small or smooth models \cite[]{TikhonovA.N.1977}.

Because in our ATEM data we have only a singe datum for each transmitter, we do not have intrinsic depth resolution.
% This could be overcome if there were multiple receivers for each transmitter, although usual ATEM surveys only have a single receiver.
This is the same circumstance encountered when inverting magnetic data. \cite[]{LiMag3D}. Correspondingly we apply a depth weighting through the model weighting matrix ($\mathbf{W}$):
\begin{linenomath*}
\begin{equation}
    \mathbf{W} = \mathbf{diag}(\mathbf{z-z_0})^{1.5},
    \label{eq: weight_mat}
\end{equation}
\end{linenomath*}
where $\mathbf{z}$ and $\mathbf{z_0}$ are discretized depth locations and reference depth in the 3D domain.

Although we use the linear form of $\dip$ data (eq. \ref{eq: dIP_lineareq}), the inverse problem is nonlinear because of imposed positivity on $\mathbf{m}$.
We solve this constrained optimization problem using a projected Gauss-Newton (GN) method \cite[]{Kelley}. For further details of implementing this constrained optimization see \cite{Marchant2012b}.
The trade-off parameter, $\beta$, is determined using a cooling technique where $\beta$ is progressively reduced from some high value. The inversion is stopped when the tolerance is reached (cf. \cite{Nocedal1999,DougTutorial}).

For the implementation of our IP inversion algorithm, we use an open source python package for simulation and gradient-based parameter estimation in geophysics called \SimPEG \cite[]{Cockett2015}.


%% ============================================================
%%% SUBSECTION
\subsection{3D IP inversion workflow}
The 3D IP inversion methodology provides us with a capability to invert IP data at each time channel. However, before we invert those IP data, we need to compute an estimate of $\siginf$ which is needed for EM-decoupling as well as generating the sensitivity matrix.

% However, before we invert those IP data, we need to compute the IP data by applying the EM-decoupling with the known $\siginf$ distribution. As we commented, distribution of $\siginf$ is not known in practice hence, we need to estimate that to proceed both EM-decoupling and IP inversion.

% DWO: this could be for later discussion: For inversions of the EIP data, the two-stage IP inversion method has been successfully used: first invert DC data to estimate conductivity then use that to compute sensitivity function for the IP inversion. However, this may not applicable for the ISIP data because it does not have any DC data. Even for the EIP problem, in reality there are always EM-coupling, which could be significant compared to the IP signals.

Considering the multiple tasks required to restore IP information from TEM data we use the following workflow: (1) Estimate a 3D distribution of $\siginf$. An effective option is to invert early-time TEM data that appear not to be contaminated with IP effects. (2) forward model the estimated conductivity, $\sigma_{est}$ to obtain the fundamental response $d^F$ and subtract it from the observations to obtain $\dip$ data.
% In this $\dip$ data, there possibly can be some errors due to the discrepancy between $\sigma_est$ and $\siginf$, which could be important in some situations. However, we do treat this issue in this article.
(3) Invert  $\dip$ data to recover a pseudo-chargeability model at individual time channels using the relationship in eq. (\ref{eq: dIP_lineareq}).
(4) Further, process the inversion outputs at multiple time-channels  to estimate the Cole-Cole, or equivalent IP parameters. For detailed descriptions of this step see Appendix \ref{section: extract_intrinsicIP}.

In the following we investigate each of the above steps via numerical simulations and test the validity of our assumptions.

%% ============================================================
%% Section. Numerical experiments
%% ============================================================

\section{Numerical experiments}
\label{section: numerical_examples}
For our numerical experiments we concentrate upon coincident-loop ATEM surveys. This choice is made because of the observed negative transients that are direct indicators of IP phenomena \cite[]{SmithandKlein,Kratzer2012,Kang2015a}, and the extensive use of this survey by industry.

We begin with a simple IP model composed of a chargeable block in a halfspace as shown in Figure~\ref{F: IPModel}.
Cole-Cole parameters of the block are  $\eta$ = 0.2, $\tau$ = 0.005s and $c$ = 1.
The conductivity  of the halfspace, ($\sigma_1$) is  $10^{-3}$ S/m, whereas the conductivity of the chargeable body, $\sigma_2$ is variable;  $\siginf$ is thus a 3D distribution.
We consider three cases: a) canonical ($\sigma_2=\sigma_1$), b) conductive ($\sigma_2=10^2\times\sigma_1$) and c) resistive models ($\sigma_2=10^{-2}\times\sigma_1$).
The 3D earth is discretized with  $50\times50\times50$ m core cells and the number of cells in the domain is $41\times41\times40$.
The size of the chargeable body is $250\times250\times200$ m and the top boundary is located  $50$ m below the surface.
The EMTDIP code \cite[]{Marchant2014} is used to compute forward ATEM responses that include IP effects. The survey consisting of 11 soundings along each of 11 lines is shown in Fig. \ref{F: IPModel}(a).
Data are from a  coincident-loop system and the flight height is 30 m above the surface; the radius of the loop is 10 m.
A step-off transmitter waveform is used and the range of the observed time channels is 0.01-60 ms. The observed responses can be the vertical component of $\b$ or $\frac{\partial \b}{\partial t}$.

In this section, we first decompose the observed responses and the total currents into fundamental and IP portions to aid in the basic understanding of IP effects in ATEM data.
Second, we validate the linearized functional by computing the approximate IP current and IP responses, and compare these  with the true values.
Third, we invert the IP data and recover 3D distributions of pseudo-chargeability at multiple times.  Lastly, we use the recovered pseudo-chargeabilities to examine the potential to extract intrinsic Cole-Cole parameters.


%% ============================================================
%%% SUBSECTION
\subsection{IP responses}
Using the  EMTDIP code and carrying out two simulations, we compute the IP data via subtraction in eq. (\ref{eq: IPdatum_syn}).
Fig. \ref{F:Three_IPresp} shows the observed, fundamental, and IP responses at a sounding location above the center of the chargeable body for (a) canonical, (b) conductive and (c) resistive models. Both $b_z$ and $-\frac{\partial b_z}{\partial t}$ data are shown.
The IP effects are most noticeable for the conductive body and we turn attention to this example first. The IP response starts to significantly affect the observations near 0.6 ms and the observed responses show a sign reversal near 1 ms. Beyond that time the signal is dominated by the IP. The dashed line in Fig. \ref{F:Three_IPresp}(b) shows that after turning off the transmitter current, the IP current increases (as inferred by the magnitude of the $b_z$ field) until about 1 ms and then decreases. We interpret this in terms of charging and discharging phases and a vertical dashed line in the figure defines the two phases. In the charging phase at early times the EM effects dominate and IP signals are not expected to be observed. In the discharging phase, which occurs at  later time, the IP effects may eventually dominate the EM effects. The maximum of the $b_z^{IP}$ corresponds to the zero crossing for $-\frac{\partial b_z^{IP}}{\partial t}$ but the times at which the IP signal becomes dominant are delayed compared to $b_z^{IP}$. By comparing the observations with the fundamental fields we see that the IP signal could be recognized in the $b_z$ data near 0.7 ms and near 2.0 ms in the $-\frac{\partial b_z}{\partial t}$ data.

The plots for the canonical and resistive bodies show that the time that separates charging and discharging occurs earlier than for the conductive body. This is a reflection that the fundamental currents reside for a longer time in a conductor. For the canonical body, a significant difference between the measured responses and the fundamental fields occur about 0.9 ms for $b_z$ and about 2 ms for $-\frac{\partial b_z}{\partial t}$. The amplitudes of the IP responses are significantly smaller than those for the conductor.  Lastly, there is little IP signal for the resistive body; the IP signal is much smaller than the fundamental response throughout the given time range. This is a consequence of the small fundamental currents in the resistor.

The decay curves from a sounding location  provide insight about the IP response but more is gleaned by looking at data from all  sounding locations in the ATEM survey. We focus on $b_z^{IP}$ for the conductive block at selected time channels. Fig. \ref{F:IPresp_Plan} shows interpolated maps of the observed, fundamental and IP responses at (a) 0.86 ms and (b) 6.7 ms which are respectively included in the charging and discharging times. For the conductive block, 0.86 ms is close to the peak time when transition from charging to discharging occurs, but it is still included in the charging time.
At this time, the observations are dominated by the fundamental response and no negative values,  which are the signature of the IP effect, are observed. Subtracting the fundamental however, yields a residual $\dip$ data map that has a strong negative. This  example  shows that our EM-decoupling procedure can  work satisfactorily.  At 6.7 ms, obtaining good IP data are easier because the observed data already show negative values. There is still a weak fundamental field and the subtraction process improves the $\dip$ response. The $\dip$ data at  0.86 ms and 6.7 ms shown in Fig. \ref{F:IPresp_Plan} are of sufficient quality to be inverted.

% \textit{alter the color scale on Fig 5}


%% ============================================================
%%% SUBSECTION
\subsection{Polarization currents}
% Doug: What exactly is this section verifying wrt to any approximations?
% Seogi: This sections shows pieces we use to bulid up the sensitivity matrix, and check our expected behavior about polarization currents.
To evaluate the polarization current shown in eq. (\ref{eq:polarization_current}) for the linear functional, we assumed $\e(t) \approx \eref w^e(t)$ and defined our reference current as $\j^{ref}=\siginf \eref$. That yielded our approximation of the polarization current to be $\j^{pol}(t) \approx -\j^{\ ref} \peta(t)$. This approximation requires that the polarization current has a  direction antiparallel to the reference current, and the direction is the same for all times. With this approximation the time dependence for the polarizaation currents only occurs through the scalar $\peta(t)$. We investigate the approximation by evaluating both reference and polarization currents numerically.
From eq. (\ref{eq:reference_electricfield}), a reference current can be considered as the maximum fundamental current that occurred throughout the  time history.
To evaluate polarization currents we rearrange eq. (\ref{eq:IP_current}) as $\j^{pol} = \j^{IP} - \siginf\e^{\ IP}$.

Here we limit our attention to canonical and conductive blocks.
Figs ~\ref{F:ReferenceCurrent}(a)   and (b) show reference currents for the canonical and conductive blocks, respectively.
A transmitter is located at (-200 m, 0 m, 30 m) and marked as a white solid circle in the figure, where ($\cdot, \cdot, \cdot$) refers to a point at (easting, northing, depth).
Reference currents for the canonical block are circular, centered on the transmitter location, and decay with distance.
For the conductive block, additional vortex currents are induced.
We compare these reference currents with the polarization currents.
Fig. ~\ref{F:Polarizationcurrent_early} shows the plan and section view maps of the polarization currents at 0.86 ms.
Comparisons of Figs ~\ref{F:ReferenceCurrent} and ~\ref{F:Polarizationcurrent_early} clearly show that polarization currents for both canonical and conductive blocks are oppositely aligned with respect to their reference current. This was the hypothesized outcome.
Fig. ~\ref{F:Polarizationcurrent_late} shows that the direction of polarization currents at 6.7 ms is similar to those at 0.86 ms. Thus both for the canonical and conductive blocks, the direction of polarization currents after 0.86 ms is constant in time.

Of  particular interest is the difference in character of the polarization currents for the canonical and conductive bodies. For the canonical body the currents look like anomalous galvanic currents that would be expected from an EIP survey. The resultant magnetic fields will be similar to the magnetic fields obtained from an electric dipole. For the conductive case however, the currents are circular and they reflect the vortex nature of the induced currents. The resultant magnetic fields are those associated with a magnetic dipole. The polarization currents inside a body are therefore complicated by the fact that they are a mixture of galvanic and inductive processes. Our choice of reference currents effectively incorporates this complexity.


% the one of the blocks, we expect  IP responses that could be explained by an electric dipole current in a chargeable medium \cite[]{seigel1959}.
% However, for the ISIP additional complexity arises due to vortex currents induced in a conductor because these generate complicated polarization currents within the chargeable medium.
% omplicated direction of polarization currents for a conductive medium.

%% ============================================================
%%% SUBSECTION
\subsection{IP currents}
The IP currents, as provided in eq. (\ref{eq:IP_current}), are given as
\begin{linenomath*}
\begin{equation}
  \j^{IP}=\siginf  \e^{\ IP} + \j^{pol}.
\end{equation}
\end{linenomath*}

In most analyses, e.g. \cite{Smith1988a}, the term $\siginf \e^{\ IP}$ is neglected. We have included this term but with an approximation that $\e^{\ IP} \approx -\nabla \phi$  (eq. \ref{eq: eip_approx}). Here we investigate these approximations, and under what circumstances they hold.

Using the forward modelling we can evaluate $\e^{\ IP}$.
This field can be broken into galvanic and inductive parts using the Helmholtz decomposition \cite[]{Bladel}: $\e=-\grad \phi-\vec{a}$ so that $\j^{IP} = \j^{pol} -\siginf \grad\phi^{IP} - \siginf \vec{a}^{IP}$.
In our work we included the effects from the scalar potential but neglected any contribution from the vector potential. We look at the contributions of each of these terms  for the three cases of canonical, conductive and resistive bodies.
Fig. ~\ref{F:IPcurrents_helmholtz_early} respectively shows plan view maps of $\j^{pol}$, $-\siginf \grad\phi^{IP}$, and $-\siginf \vec{a}^{IP}$for (a) canonical, (b) conductive, and (c) resistive models at 0.86 ms.

Inside the body, the polarization currents have the greatest strength and the strength of these currents is largest in the conductive body and smallest in the resistive body.
In all cases, the polarization currents are the largest contribution to $\j^{IP}$.
The second column in Fig. \ref{F:IPcurrents_helmholtz_early} is related to the scalar potential for the electric field or effectively to the galvanic currents.
These exist both inside and outside the chargeable body.
Again, these are largest for the conductive body.
We note that inside the body, these currents have a direction that is opposite to the polarization currents.
The third column is associated with the vector potential for $\e^{\ IP}$ and is associated with vortex currents.
The effects of these currents have not been included in our linearized approximations. These currents are quite small for the canonical and resistive models but their amplitude starts to be comparable to the galvanic portion for the conductive model.
% \textit{We note that the direction of the vortex currents inside the body is the same as for the galvanic currents and opposite to the polarization currents.}

We evaluate $\j^{IP} $ and its components at two locations in the body for conductive model. These are denoted by white stars in the figures.  For both locations, the polarization currents have the greatest strength and the vortex currents are smaller than the galvanic currents. The IP current is smaller than the polarization current mostly because the galvanic IP currents are in the opposite direction compared to the polarization currents. The results are tabulated in Table \ref{T:DecompjIPcond}.

The above figures provide insight about the three contributions to $\j^{IP}$ but of ultimate interest is the effect of these currents on the measured data.
We therefore apply the Biot-Savart law to each current. It suffices to work with the conductive case.
Fig. ~\ref{F:DecompjIPcond} shows IP responses computed from the polarization current (stars), galvanic (rectangles) and inductive portions (circles) of the IP current. Here solid and empty markers show negative and positive signs, respectively.
The polarization current has the major contribution to the IP response although it is larger than the true value. This overshoot is primarily negated by the galvanic portion of IP responses and further reduced because of the vortex currents. We notice that the contribution of the galvanic currents is generally larger than those due to the vortex currents except near 0.4 ms.
At 6.7 ms, the amplitude of the  IP response due to the polarization current is about 130 percent of the true one, while galvanic portion is 30 percent.
These results show that the assumption by \cite{Smith1988a} is reasonable, but incorporation of the galvanic portion to the IP datum is significant at later times.
The inductive portion of the IP responses  is small  compared to the galvanic portion except for the time before 0.2 ms, and hence ignoring this is generally justified.

%% ============================================================
%%% SUBSECTION
\subsection{Validations of linearization}
Forward modelling using eq. (\ref{eq: dIP_lineareq}) requires that we have adequately estimated the IP currents and we can evaluate their response using the Biot-Savart law. To validate this we first compute approximate IP currents using eq. (\ref{eq: jip_approx}), and first compare them with the true IP currents. It suffices to work with the conductive model which is the most challenging. Fig. ~\ref{F:IPcurrent_PlanandSec_early} compares the true and approximate IP currents at 0.86 ms. The approximate IP currents match well, both in direction and amplitude, with the true IP currents both inside and outside the body. As shown in Fig. ~\ref{F:IPcurrent_PlanandSec_late} the agreement improves as time increases (see the directions of the true and approximate IP currents at (0,0,-350) on the right panels of Figs \ref{F:IPcurrent_PlanandSec_early} and \ref{F:IPcurrent_PlanandSec_late}).

We next test the validity of the computation of IP responses by using our formulation of the Biot-Savart law. To do this we compute the ``true'' IP responses  by subtracting the fundamental response from the observations. We next compute the IP responses by evaluating the Biot-Savart law with the true IP currents shown in Fig. ~\ref{F:IPcurrent_PlanandSec_late}(a). As shown in Fig. ~\ref{F:True_vs_approx_IPresp} the agreement between these responses is very good after 0.01 ms. This validates the use of the Biot-Savart law (eq. \ref{eq: BiotbIP_approx}). Lastly, we want to compare responses, evaluated through the Biot Savart law, but use our approximated IP currents (Fig. ~\ref{F:IPcurrent_PlanandSec_late}b). The results are shown in Fig. ~\ref{F:True_vs_approx_IPresp}. The responses obtained from using our approximate currents have lower amplitude and differ by 33 percent at the extreme. The difference decreases with increasing time. Overall the two curves are in reasonable agreement, thus validating our linearized forward modeling (eq. \ref{eq: dIP_lineareq}).

The same analysis of comparing true and approximate $\dip$ data was carried out for the canonical and resistive models.
%(As shown in  Fig. ~\ref{F:True_vs_approx_IPresp}, both cases show the agreements is further improved.)
As shown in  Fig. ~\ref{F:True_vs_approx_IPresp}, the true and approximate $\dip$ for both cases show good agreements.
We note however, that despite the fact that our linear functional reasonably explains $\dip$ data for the resistive case, the IP signals are very small compared to EM signals and we likely cannot identify them in practice.

% ** figure caption has typos***

%% ============================================================
%%% SUBSECTION
\subsection{3D IP inversions}
Using our linearized sensitivity, we now proceed with 3D IP inversion, which recovers a pseudo-chargeability given by eq. (\ref{eq: dIP_lineareq}).
We limit our attention to the conductive case ($\sigma_2$=0.1 S/m). For the computation of the sensitivity we use $\sigma_{est}$ to be the true 3D conductivity model ($\siginf$) and then invert data at successive time channels and recover 3D pseudo-chargeability at multiple times.
Our 3D inversion is based upon \cite[]{doug1994,Li2000}, and it requires some choices for inversion parameters.

For data uncertainties, we use one percent of the maximum amplitude of the observed data (0.01$max(|\mathbf{d}^{obs}|)$). Coefficients for smallness and smoothness are set to $\alpha_s=10^{-5}$ and $\alpha_x=\alpha_y=\alpha_z=1$, respectively. The reference model is zero, which means the pseudo-chargeability of every cell is zero, and we applied a depth weighting.
The need for a depth weighting arises because the sensitivity function $J[\cdot]$ is primarily controlled by a $1/r^3$ decay associated with the Biot-Savart kernels.  Thus an ATEM data set is not unlike a magnetic data set where it is well established that a depth weighting is required to image objects at depth. The following example illustrates this.

We first generate IP responses at a single time using the linear functional and specifying that the pseudo-chargeability is unity inside the body and zero outside, as shown in  Fig. \ref{F:Depthweight}(a).
Fig. \ref{F:Depthweight}(b) shows the recovered pseudo-chargeability without depth weighting.
The recovered anomalous pseudo-chargeability is concentrated  near the surface and the magnitude of the pseudo-chargeability is underestimated; it is $\sim$0.2 rather than unity.
By using the depth weighting shown in eq. (\ref{eq: weight_mat}),  the IP body is imaged closer to its true depth (Fig. \ref{F:Depthweight}b).
Also, the magnitude of the recovered pseudo-chargeability ($\sim$0.6) is closer to the true value than the result without depth weighting.
Based on this analysis, we use the same depth weighting for our  following examples.

%% ============================================================
%%% SUBSECTION
\subsubsection{Incorrect conductivity}
\label{subsubsection: Incorrect conductivity}
The 3D distribution of $\siginf$ plays a central role in our analysis. It is used in the EM-decoupling process and it is also needed to compute the linearized sensitivities for inversion.
Therefore, estimating 3D distribution of $\siginf$ is an essential step, and inverting early TEM signals having minor IP effects can be an effective option.
In this paper we do not focus on  estimating $\siginf$. We do however appreciated that this will never be known exactly. We address this in more detail in Section \ref{section: Estimating the background conductivity}, but here we explore some consequences of having an incorrect $\sigma_{est}$. We return to our conductive block in a halfspace and evaluate the $\dip$ data when the halfspace conductivity is the true value ($\sigma_1 = 10^{-3}$ S/m) as well as a factor of two too large (2$\times10^{-3}$ S/m) and a factor of two too small (5$\times10^{-4}$ S/m). Here conductivity of the chargeable block is fixed to $\sigma_2$ = 0.1 S/m. The data along a survey line are plotted in Fig. \ref{F:Reg_IPresp}.

We invert these three IP responses, and provide sections of the recovered pseudo-chargeability at 0 m-northing.
Fig. \ref{F:Regional_IPInv}(a), (b) and (c) correspondingly show the recovered pseudo-chargeability when the conductivity is: the true value, too high, or too low.
With the correct conductivity the geometry of the IP body is reasonably recovered.
When the halfspace conductivity is too high, the $\dip$ have a negative bias that results in larger pseudo-chargeabilities and positive-valued artifacts near the IP body (Fig. \ref{F:Regional_IPInv}b).
When the halfspace conductivity is too small, the IP data have a positive bias and this produces negative-valued artifacts near the IP body (Fig. ~\ref{F:Regional_IPInv}c). White dotted contours shown in Fig. ~\ref{F:Regional_IPInv}(c) shows zero-crossing lines, which delineate those negative-valued artifacts. However, based on the  definition of the pseudo-chargeability shown in eq. (\ref{eq: petaeff}), the sign of the pseudo-chargeability should be positive. By incorporating positivity as a constraint in the inversion, and re-inverting the IP data that have a positive bias, we obtain the result in  Fig. \ref{F:Regional_IPInv}(d).  This is a much better result than Fig. \ref{F:Regional_IPInv}(c), and it shows that the positive constraints prevent fitting positive residual fields.
%(comparison of the observed and predicted data for this case shown in Fig. \ref{F:Reg_obspred} clearly shows how this constraint prevents the fitting of positive residual fields.)
We shall use this positivity  constraint for our following 3D IP inversion examples.

The 3D distribution of $\siginf$ is also needed when computing the sensitivity function, since we need the reference electric field, which is dependent on conductivity.
An incorrect conductivity will then affect the sensitivity function.
In order to test this, we compute the sensitivity matrix using a halfspace conductivity model ($\sigma_1=\sigma_2$ = 0.001 S/m).
Fig. \ref{F:True_vs_approx_sensitivity} compares the recovered pseudo-chargeability from the 3D IP inversion of the IP datum at 0.86 ms with the true and incorrect sensitivity function using the halfspace conductivity.
There is not a large difference between the two inversions  which suggests that an approximate conductivity may still provide sensitivities that are adequate for inversion. This parallels results from EIP where even an approximate conductivity can still yield good results when inverting the data. Thus there is robustness in our sensitivity function with respect to an  incorrect conductivity.
These results suggest that even if one cannot generate a good estimate of
$\siginf$, a halfspace conductivity might produce an adequate sensitivity function, and hence an inversion can provide some indication of a chargeable body.
% and even if we  not have an accurate 3D conductivity model we can still apply our 3D IP inversion using halfspace conductivity so long as the ATEM data includes distinctive IP response such as negative transients.

%% ============================================================
\subsubsection{Extracting intrinsic IP parameters}
By applying our inversion to each time channel of $\dip$ data separately, we can recover 3D distributions of pseudo-chargeability at multiple times.
The pseudo-chargeability at each time carries different information about the state of polarization and we can use these to recover information about intrinsic IP parameters.
Diverse time-dependent conductivity models such as the Cole-Cole model and stretched-exponential can be used for this interpretation.
We use the Cole-Cole model with $c=1$.
We parametrize pseudo-chargeability at a single pixel in terms of chargeability and time constant as described in Appendix \ref{section: extract_intrinsicIP}, and solve a small inverse problem.
In previous works about this task for the EIP problem \cite[]{Yuval1997,Hordt2006}, the convolution shown in eq. ~\ref{eq: pseudochargeability_petaI} was not explicitly mentioned because $\hat{w}(t)$ is a step-off or -on function and it does not change for different cells and transmitters. This allowed an explicit equation for a step-off or -on response of the pseudo-chargeability to be derived.
However, in our work, convolution plays a fundamental role and needs to be explicitly addressed when extracting intrinsic IP parameters. Also, the details regarding how we defined the effective pseudo-chargeability (eq. ~\ref{eq: peta_eff}) needs to be included.  Except for this additional complexity related to the convolution, our approach parallels that of \cite{Yuval1997,Hordt2006}.

As an example, we use the conductive and chargeable block presented in the previous section and invert 14 time channels of data ranging from 1-10 ms.  The EM data are forward modelled using EMTDIP code and the true $\siginf$ model is used  to evaluate the IP datum and compute the sensitivity function. The recovered pseudo-chargeability from one of the 14 inversions is shown in Fig. \ref{F:True_vs_approx_sensitivity}a. In that pseudo-chargeability model, we select cells that have a pseudo-chargeability value greater than 0.001, and then carry out the nonlinear inversion to estimate the time constant, $\tau$,  and chargeability, $\eta$, for each cell separately. The forward modelling for this inversion is shown in eq. (~\ref{eq: peta_eff}), which requires $w^e(t)$ (eq. ~\ref{eq: we_eff}).
The $w^e(t)$ for a pixel in the block is shown in Fig. \ref{F:AveragedWe}.

Fig. ~\ref{F:EtaTauSection}(a) and (b) correspondingly show the estimated time constants and chargeability as section maps.
The estimated time constants show good agreement with the true value $\tau$= 0.005s.
There is less agreement about chargeability for which the true value is $\eta=0.2$. Recovered values range from about 0.04-0.2 so most values are underestimated.
In Fig. \ref{F:IntrinsicIP}, we also provide time decays of the observed and predicted pseudo-chargeabilities at a single pixel marked as a black empty rectangle in Fig. ~\ref{F:EtaTauSection}. The estimated time constant,  $\tau_{est}$, and chargeability, $\eta_{est}$, for this pixel are 0.0046 and 0.09, respectively.
These results imply there is greater  stability on recovering the time constant than on recovering chargeability with our approach. Again, similar experiments were carried out for the canonical and resistive bodies and the conclusions were also that the time constant was adequately recovered with better fidelity than was the chargeability.

%% =============================================================================
%% Section. Estimating the background conductivity $\siginf$
%% =============================================================================
\section{Estimating the background conductivity}
\label{section: Estimating the background conductivity}
In this paper we have generally assumed that a good estimate of 3D $\siginf$ was available. If it is, then we have shown that we can obtain IP data by subtracting the fundamental responses from the observations. This process is sometimes referred to as EM-decoupling and its solution has been a long-standing goal in exploration geophysics. For the ATEM survey, one potential approach to finding $\siginf$ is to invert the early-time data in which the EM response is much larger than the IP response (for example inverting time channels 2 to 10 ms in the left panel of Fig ~\ref{F:Three_IPresp}b). The success of this method is dependent upon three factors: (a) that the data are uncontaminated by IP effects (i.e. there is no IP-coupling); (b) that the data acquisition is sufficiently dense in space and in time so that needed information about 3D $\siginf$ is obtained; (c) an inversion algorithm exists that can generate a 3D conductivity model. Even so, the recovered conductivity will not be equal to the true conductivity. In Section ~\ref{subsubsection: Incorrect conductivity}, we showed how the estimated IP data are affected when a halfspace conductivity is altered by a factor of two. This was a simple example but it illustrated the general effects of an incorrect conductivity and ameliorating effects of the positivity constraint in the IP inversion (eq. ~\ref{eq10}). The problem will become more challenging when there is substantial spatial variation between the true and estimated conductivity. It is conceivable that if the ATEM data show no negative values and if the conductivity approximation is sufficiently poor then our EM-decoupling procedure will fail to produce quality IP data. This will have to be addressed for each survey. What we did demonstrate here was that even an approximate $\siginf$ is sufficient to generate the sensitivities, and hence if quality IP data can be isolated from observations, then our techniques can unravel the data to generate information about the polarization structure.

%% =============================================================================
%% Section. Conclusions
%% =============================================================================
\section{Conclusions}
In this paper, we have introduced a procedure for recovering IP information from TEM data with inductive sources. Three main steps are required: 1) subtraction of the fundamental responses from the observations to generate IP data, 2) linearization of the IP responses as a function of the pseudo-chargeability, and 3) restoration of 3D pseudo-chargeability at multiple times, and further interpretation of the pseudo-chargeability to extract intrinsic IP parameters like Cole-Cole model. We used the ATEM survey to test our IP inversion procedure.

The first step requires a good estimate for 3D distribution of $\siginf$. This is important for two reasons. The 3D $\siginf$ is used to generate the fundamental fields that are subtracted from the observations to produce the IP data. This conductivity is also needed to compute the sensitivities for our linear relationship between the IP data and pseudo-chargeability. Inverting early-time TEM signals that are felt to be uncontaminated with significant IP responses could be an effective option for this step.
For the mid-time data, subtraction of the fundamental responses from the observations revealed negative data even though the observations were positive. At very late times this subtraction process was not necessary since the EM fields had sufficiently decayed.
We note that maps of the $d^{IP}$ data can, in themselves, be a useful processing tool for detecting anomalies. For practical applications, where we propose inverting early TEM data to recover $\siginf$ in 3D, the effects on an incorrect $\siginf$ on the $d^{IP}$ data will need to be investigated.

%(anomaly hunting.)
% To establish a solid theoretical background for linearizing ISIP responses and for developing an IP inversion methodology we assumed that $\siginf$ distribution is known. For practical applications of our suggested IP inversion workflow, inverting early TEM data is crucial procedure, hence, should be carefully investigated with more realistic examples.

The second item, linearization of the IP responses with respect to a pseudo-chargeability, required that a number of assumptions be made. Our pseudo-chargeability is defined as the ratio of the polarization current to a reference current. Unlike the EIP case, the electric fields for an inductive source do not achieve steady-state and hence neither do the polarization currents. To address this important difference we evaluate the fundamental fields at each location in the earth and generate a reference electric field that has the direction and magnitude of the field at the time when the fundamental field  reaches its maximum value. The pseudo-chargeability at a point in the earth thus depends upon the chargeability, the reference electric field, and the time history of the fundamental electric field. The situation becomes more complicated when data from many transmitters are to be inverted simultaneously because the time history of the electric field at a point in the earth is different for each transmitter. We handle this by defining an effective pseudo-chargeability and an associated reference electric field that accommodates, in a least squares fashion, the effects of all transmitters acting on a single cell.

To have confidence in when, and under what circumstances, our approximations are sufficiently valid, we proceed with a number of rigorous tests. First we introduce 3 test models which are respectively a chargeable block in a halfspace. The block can be conductive, canonical, or resistive with respect to the halfspace conductivity. Our evaluations show that:
(a) our choice of reference electric field and its time history produces a good estimate of the polarization currents;
(b) the IP currents are dominated by the polarization currents, which is an assumption that is often made. However, the galvanic and vortex currents arising from the scalar and vector potentials in the Helmholtz decomposition of $\e^{\ IP}$can be significant in some circumstances. The galvanic currents are the second most important contribution to the IP currents and, in the body, they have a direction that opposes the direction of the polarization currents. In our work we have included the galvanic currents and neglected the vortex currents which are almost always smaller than the galvanic currents;
(c) the IP responses can be accurately evaluated using the Biot-Savart law provides accurate results;
(d) with our approximate IP currents, the predicted responses are in reasonably good agreement with true values although they are underestimated for the highly conductive example. These results lead us to infer that our linearized formulation $\mathbf{d}^{IP}(t)=\mathbf{J}\peta(t)$ is a viable representation for the forward modelling at late times when  the IP effects are substantial compared to the EM effects.
(e) For the multi-transmitter case we derived an effective pseudo-chargeability which is a linear combination of the pseudo-chargeability of each transmitter. These were forward modelled with the linearized formulation and compared to the true responses. The values were underestimated for the conductive model but were almost identical for the canonical and resistive models.

The third component is the 3D inversion of the IP data using the linearized formulation to recover an effective pseudo-chargeability for each cell. ATEM data have only one receiver for each transmitter and a data map at a single time channel is essentially a potential field. The data do not have intrinsic resolving power and hence, as in magnetics or gravity inversions, we attempt to counteract this by introducing a depth weighting.  When this is done, our 3D IP inversion recovers a reasonable geometric shape and location of the chargeable body but the amplitude is underestimated. For the inversion it is assumed that a good estimate of $\siginf$ is available. An incorrect $\siginf$ has two effects in the inversion. Firstly it can generates errors in the $d^{IP}$ data because the fundamental field, which is subtracted from the observations, is incorrect. To obtain insight we looked at the effects when $\sigma_{est}$ was too low or two high. This respectively yielded positive or negative residual fields in the IP response. A positivity constraint on the pseudo-chargeability (similar to that used in EIP surveys) greatly ameleorated the effects of the positive residuals. The other avenue by which an incorrect $\siginf$ can affect the inversion is through the sensitivity matrix $\mathbf{J}$. We showed that, even with an approximate conductivity, we recovered important information about the chargeable body such as geometric shape and location. An inversion of the data at a particular time channel provides information about the effective pseudo-chargeability for each pixel. Inversions carried out at multiple time channels therefore generates a pseudo-chargeability as a function of time for each pixel. The pseudo-chargeability for pixels that had significant chargeability were subsequently fit to a Cole-Cole model to estimate $\tau$ and $\eta$ by assuming $c=1$. The estimated $\tau$ was close to the true value whereas $\eta$ was underestimated and less robust. This suggests that there is a possibility to extract intrinsic IP parameters from the recovered pseudo-chargeability from ATEM surveys.

Our IP inversion procedure provides a framework for recovering IP information from inductive source EM surveys and in particular from ATEM surveys that are commonly flown. Our examples show: (a) that the horizontal location of a target body can be well recovered; (b) the overall geometry might be recovered but much of that inference requires a depth weighting to be included; (c)  we can recover estimates of intrinsic $\tau$ and $\eta$ that may be useful for distinguishing between two chargeable targets. Our procedure depends on having a good estimate for the background conductivity and this aspect this should be carefully investigated in future practical applications. Other areas for follow-up research include quantifying  depth of resolution for  airborne IP surveys, and general strategies for extracting intrinsic IP parameters from our effective pseudo-chargeabilities.
Lastly, our numerical examples only treated the ATEM survey, but the procedure is applicable to other types of inductive source TEM survey such as a large-loop TEM with many receivers. There will be details that need to be addressed for those applications but the work presented here provides the  fundamental background for those future studies whose goal is to extract some information about polarization from an inductive time domain system.

\begin{acknowledgments}
  We wish to thank David Marchant for providing EMTDIP code, and other UBC-GIF members for their constructive comments. We would like to thank Rowan Cockett and Lindsey Heagy for their contributions to \SimPEG (http://www.simpeg.xyz).
\end{acknowledgments}
\bibliographystyle{gji}
\bibliography{reference}

\clearpage

\begin{table}
 \caption{Amplitudes of decomposed IP currents at two marked points (white stars) shown in Fig. ~\ref{F:IPcurrents_helmholtz_early}(b). Units in $A/m^2$}
 \label{T:DecompjIPcond}
 \begin{tabular}{@{}lccccc}
  Division & $| \j^{IP} |$ & $| \j^{pol} |$ & $| -\siginf\grad \phi^{IP} |$ & $| -\siginf\vec{a}^{IP} |$ \\
  Left  & $1.5\times 10^{-10}$ & $2.5\times 10^{-10}$ & $7.6\times 10^{-11}$ & $1.9\times 10^{-12}$ \\
  Right & $5.4\times 10^{-11}$ & $1.2\times 10^{-10}$ & $3.5\times 10^{-11}$ & $3.3\times 10^{-11}$ \\
 \end{tabular}
\end{table}

\clearpage

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.0\textwidth]{figures/FDandTDCole.png}}
  \caption{Cole-Cole response in frequency domain (a) and time (b) domain. The Cole-Cole parameters are $\siginf$ = $10^{-2}$ S/m, $\eta $ = 0.5, $\tau$ = 0.01 s, and $c$=1. The arrow shown in Fig. \ref{Fig:FDandTDCole}(b) indicates a delta function ($\siginf \delta(t)$). }
  \label{Fig:FDandTDCole}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.0\textwidth]{figures/DCEM_F_current.png} }
  \caption{Conceptual diagram for the amplitude of the fundamental electric fields. (a) EIP and (b) ISIP cases.}
  \label{F:DCEM_F_current}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.0\textwidth]{figures/IPModel.png} }
  \caption{Plan (a) and section b) views of the IP model. The solid line in (a) delineates the boundary of the IP body. Solid circles in (a) denote the sounding locations. In (b) the conductivity $\sigma_2$ is variable so that  canonical, conductive and resistive blocks can be examined}
  \label{F: IPModel}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/Three_IPresp.png} }
  \caption{Time decaying curves of the observations  ($d$; black line), fundamental ($d^F$; blue line) and IP ($\dip$; red line) responses. All three cases: (a) canonical, (b) conductive and (c) resistive are presented. Right and left panels show $b_z$ and $-\frac{\partial b_z}{\partial t}$. The vertical black dotted line indicates the time at which the polarization field reaches its maximum value. The flight height of the collocated transmitting and receiving loop is 30 m above the surface.}
  \label{F:Three_IPresp}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/IPresp_Plan.png} }
  \caption{Interpolated maps of observed (left panel), fundamental (middle panel) and IP (right panel) responses. Two time channels at (a) 0.86 ms and (b) 6.7 ms are presented. White line contours a zero-crossing in the observed response.
  }
  \label{F:IPresp_Plan}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1\textwidth]{figures/ReferenceCurrent.png} }
  \caption{Maps of reference currents: (a) canonical and (b) conductive models. Left and right panels show plan and section views at -125 m-depth and 0 m-easting, respectively. A transmitter is located at (-200 m, 0 m, 30 m). Black arrows and colored background respectively indicate the direction and amplitude of the current. The black solid line outlines the boundary of chargeable body.}
  \label{F:ReferenceCurrent}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1\textwidth]{figures/Polarizationcurrent_early.png} }
  \caption{Maps of polarization currents: (a) canonical and (b) conductive models at 0.86 ms. Left and right panels show plan and section views at -125 m-depth and 0 m-easting, respectively. A transmitter is located at (-200 m, 0 m, 30 m). Black arrows and shaded values respectively indicate the direction and amplitude of the current. Black solid outlines boundary of the surface or the chargeable body.}
  \label{F:Polarizationcurrent_early}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1\textwidth]{figures/Polarizationcurrent_late.png} }
  \caption{Maps of polarization currents: (a) canonical and (b) conductive models at 6.7 ms. Left and right panels show plan and section views at -125 m-depth and 0 m-easting, respectively. A transmitter is located at (-200 m, 0 m, 30 m). Black arrows and shaded values indicate the direction and amplitude of the current, respectively. Black solid outlines boundary of the surface or the chargeable body.}
  \label{F:Polarizationcurrent_late}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/IPcurrents_helmholtz_early.png} }
  \caption{Decomposition of the IP currents as $\j^{pol}$ (left panel), $-\siginf\grad \phi^{IP}$ (middle panel), and $-\siginf\vec{a}^{IP}$ (right panel) at 0.86 ms. Plan view maps of the currents at -125 m-depth are shown: (a) canonical, (b) conductive, and (c) resistive cases. }
  \label{F:IPcurrents_helmholtz_early}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1\textwidth]{figures/DecompjIPcond.png} }
  \caption{Comparisons of contributions of $\j^{pol}$, $-\siginf\grad \phi^{IP}$, and $-\siginf\vec{a}^{IP}$ to the observed IP responses. Solid line indicates true $b_z^{IP}$ responses. Stars, rectangles, and circles correspondingly indicate each IP response generated by applying Biot-Savart law to $\j^{pol}$, $-\siginf\grad \phi^{IP}$, and $-\siginf\vec{a}^{IP}$. Empty and solid markers represent positive and negative values, respectively.}
  % Doug: **** confusing: maybe solid symbpls should be positive; open negative. Also, where is the datum
  \label{F:DecompjIPcond}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1\textwidth]{figures/IPcurrent_PlanandSec_early.png} }
  \caption{Interpolated maps of (a) true and (b) approximate IP currents at 0.86 ms. Left and right columns respectively show plan and section view maps at -125 m-depth and 0 m-easting. }
  \label{F:IPcurrent_PlanandSec_early}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1\textwidth]{figures/IPcurrent_PlanandSec_late.png} }
  \caption{Interpolated maps of (a) true and (b) approximate IP currents at 6.7 ms. Left and right columns respectively show plan and section view maps at -125 m-depth and 0 m-easting. }
  \label{F:IPcurrent_PlanandSec_late}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1\textwidth]{figures/True_vs_approx_IPresp.png} }
  \caption{Comparison of true and approximate IP responses ($b_z^{IP}$). Black, blue, and red colors respectively indicate canonical, conductive, and resistive cases. Solid lines indicate true $b_z^{IP}$ computed by subtracting the fundamental response from the observation. The stars are the application of Biot-Savart to true IP current and generate $b_{z \ BS}^{IP}$. Empty circles show our approximate $b_{z \  approx}^{IP}$ response. }
  \label{F:True_vs_approx_IPresp}
\end{figure}
\clearpage

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/Depthweight.png} }
  \caption{Effect of depth weighting in 3D IP inversion. (a) True pseudo-chargeability model on vertical section at 0 m-northing. Recovered pseudo-chargeability models (b) without depth weighting and (c) with depth weighting.}
  \label{F:Depthweight}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/Reg_IPresp.png} }
  \caption{IP responses on a profile line at 0 m-northing.  IP responses are computed from perturbed $\siginf$ models. Halfspace conductivity ($\sigma_1$) is perturbed two times higher or less resulting in overestimated (dotted line) and underestimated (dashed line) IP respones. Solid line shows the true IP response. }
  \label{F:Reg_IPresp}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/Regional_IPInv.png} }
  \caption{Recovered pseudo-chargeability sections from 3D IP inversions at 0 m-northing. (a) $\dip$ with true $\sigma_1$. (b) $\dip$ with 2$\times \sigma_1$. (c) $\dip$ with 0.5$\times \sigma_1$. (d) $\dip$ with 0.5$\times \sigma_1$ and the positivity constraint on the pseudo-chargeability. White dashed lines contour zero-crossing lines.}
  \label{F:Regional_IPInv}
\end{figure}

% \begin{figure}
%   \figbox*{}{}{
%   \includegraphics[width=1.\textwidth]{figures/Reg_obspred.png} }
%   \caption{Comparison of the observed (solid line) and predicted (empty circles) data. $\dip$ response was generated with underestimated halfspace conductivity (0.5$\times \sigma_1$). The positivity constraint was used in the 3D IP inversion.}
%   \label{F:Reg_obspred}
% \end{figure}


\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/True_vs_approx_sensitivity.png} }
  \caption{Recovered pseudo-chargeabilty sections from the 3D IP inversions at 0 m-northing.  (a) True and (b) incorrect $\siginf$ is used to compute sensitivity function. For the incorrect sensitivity we used a halfspace conductivity $\sigma_1$.}
  \label{F:True_vs_approx_sensitivity}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/EtaTauSection.png} }
  \caption{Section views of recovered: (a) time constant and (b) chargeability. Any region where the peudo-chargeabiliy shown in Fig. ~\ref{F:True_vs_approx_sensitivity}a is smaller that 0.001 is ignored in this analysis, and blanked.}
  \label{F:EtaTauSection}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/IntrinsicIP.png} }
  \caption{Comparisons of the observed and predicted pseudo-chargeability at a single pixel in a chargeable body.
  The empty circles and solid line respectively indicate predicted and observed pseudo-chargeability. The estimated time constant and chargeability are respectively expressed as $\tau_{est}$ and $\eta_{est}$. The true values for $\tau$ and $\eta$ are respectively 0.005s and 0.2.}
  \label{F:IntrinsicIP}
\end{figure}

\clearpage

%% ============================================================
%% SECTION (Appendix)
%% ============================================================
\appendix

\section{Effective pseudo-chargeability}
%% ============================================================
%%% SUBSECTION
\subsection{Handling multiple transmitters in ATEM surveys}
\label{subsection: Handling multiple transmitters in ATEM surveys}
The work for inductive sources in the main section of the paper has been developed for a single transmitter and 3D information about chargeability can be obtained if there are multiple receivers. For ATEM data however, we have only a single receiver location for each transmitter but we have multiple transmitter locations.
Our goal is to alter the problem to work with an effective pseudo-chargeability.

In our linearized eq. (\ref{eq: dIP_lineareq}), each transmitter has its own sensitivity and pseudo-chargeabilty. For our airborne case the sensitivity for the $k$-th transmitter is the $k$-th row of $\mathbf{J}$ and the pseudo-chargeability is $\peta^k$. The corresponding  IP datum is
\begin{linenomath*}
\begin{equation}
  \dip_k(t) = \sum_{i=1}^{nC}J_{k,i}\peta^k_i (t), \ \ k=1, \ldots, nTx,
  \label{eq: dip_kthTx}
\end{equation}
\end{linenomath*}
where $nTx$ is the number of transmitters, $nC$ is the number of cells in the domain, and $J_{k,i}$ indicates an element of the Jacobian matrix for the $k$-th transmitter and the $i$-th cell. We want to replace $\peta^k_i$ with a single effective pseudo-chargeabilty $\peta_i$ and therefore write the IP datum as
\begin{linenomath*}
\begin{equation}
  \dip_k(t) = \sum_{i=1}^{nC}J_{k,i}\peta_i (t), \ \ k=1, \ldots, nTx,
  \label{eq: dipeff_kthTx}
\end{equation}
\end{linenomath*}
The waveforms are different for each transmitter and hence this representation cannot be exact. To examine the implications of this it suffices to look at the contribution of any volumetric pixel. Each pixel contributes to all of the IP data but in differing amounts. The total contribution of the  $i$-th pixel to the $nTx$ data set at a single time is
\begin{linenomath*}
\begin{equation}
  q_i =\sum_{k=1}^{nTx} J_{k,i} \peta^k_i(t), \ \ i=1, \ldots, nC.
  \label{eq: dip_hat}
\end{equation}
\end{linenomath*}
Our goal is to find an effective chargeability that produces the same net effect on the measured data. We search for a transmitter-independent $\peta_i$ such that
\begin{linenomath*}
\begin{equation}
  q_i^{est} =\sum_{k=1}^{nTx} J_{k,i} \peta_i(t), \ \ i=1, \ldots, nC.
  \label{eq: dip_tilde}
\end{equation}
\end{linenomath*}
Minimizing the least squares difference between eqs (\ref{eq: dip_hat}) and (\ref{eq: dip_tilde}) yields
\begin{linenomath*}
\begin{equation}
  \peta_i(t) = \frac {\Sigma_{k=1}^{nTx} J_{k,i}^2\peta^k_i(t)} {\Sigma_{k=1}^{nTx} J_{k,i}^2} = \sum_{k=1}^{nTx} a^k_i \peta^k_i(t), \ \ i=1, \ldots, nC.
  \label{eq: petaeff}
\end{equation}
\end{linenomath*}
where the normalized weight ($p^k_i$) is
\begin{linenomath*}
\begin{equation}
  p^k_i = \frac {J^2_{k,i}} {\Sigma_{k=1}^{nTx} J^2_{k,i}}, \ \ i=1, \ldots, nC.
  \label{eq: normalized_weights}
\end{equation}
\end{linenomath*}

With the above understanding about how $\peta_i$ relates to the $\peta_i^k$ from each transmitter we can proceed  as follows. Firstly, from eq. (\ref{eq: pseudochargeability}) we have
\begin{linenomath*}
\begin{equation}
  \peta_i^k(t) =\peta^I \otimes \hat{w}^{k}_i(t)
  \label{eq: peta_transmitters}
\end{equation}
\end{linenomath*}
Substituting eqs (\ref{eq: peta_transmitters}) into (\ref{eq: petaeff}) allows us to write
\begin{linenomath*}
\begin{equation}
  \peta_i(t) = \peta^I(t) \otimes w^e_i(t),
  \label{eq: peta_eff}
\end{equation}
\end{linenomath*}
where we define the effective time history of the electric field, $w^e_i(t)$ as
\begin{linenomath*}
\begin{equation}
  w^e_i(t)= \sum_{k=1}^{nTx} a^k_i \hat{w}^{k}_i(t), \ \ i=1, \ldots, nC.
  \label{eq: we_eff}
\end{equation}
\end{linenomath*}

The above equations shows that the pseudo-chargeabilty for any pixel recovered from the inversion is equal to the convolution of the impulse pseudo-chargeability, $\peta^I(t)$, with an effective time history of the electric field $w^e(t)$. Although it is somewhat involved, the $w^e(t)$ associated with each pixel can be evaluated by knowing the electric fields associated with the fundamental EM problem. Ultimately this allows us to estimate the parameters associated with the impulse pseudo-chargeability in the same manner as outlined for the case with a single transmitter. Our ability to evaluate the $w^e(t)$ and test the validity of eq. (\ref{eq: dipeff_kthTx}) istreated in Section \ref{subsection: Effective pseudo-chargeability for ATEM data}.

% Doug
% This includes all grounded surveys with multiple transmitters and to a single source inductive EIP surveys.

%% ============================================================
%%% SUBSECTION
\subsection{Effective pseudo-chargeability for ATEM data}
\label{subsection: Effective pseudo-chargeability for ATEM data}

In Appendix \ref{subsection: Handling multiple transmitters in ATEM surveys} we showed how to define an effective chargeability when we have multi-transmitters. For each pixel we have
equation:
\begin{equation}
  \peta_i(t) = \peta_i^I(t) \otimes  w_i^e(t),
\end{equation}
where $\peta_i^I(t)$ is the impulse pseudo-chargeability associated with an individual pixel. The effective time history of the electric field, $w_i^e(t)$ is a linear combination of the fundamental electric fields due to the individual transmitters. We can calculate $w_i^e(t)$ and carry out the convolution to evaluate the effective pseudo-chargeability. The IP data can then be forward modelled using eq. (\ref{eq: dIP_lineareq}). This allows us to validate eq. (\ref{eq: dipeff_kthTx}), which demonstrated linear form of $\dip$ data at all transmitter locations, by comparing results with the true IP data obtained via forward modelling.
%(We can test eq. (\ref{eq: dipeff_kthTx}) by comparing results with the true IP data obtained via forward modelling.)
 It is only necessary to apply this to the conductive model.

The evaluation of the effective pseudo-chargeability is carried out on  a cell by cell basis. For each cell  we  first evaluate $w^e(t)$ (eq. \ref{eq: we_eff}). This requires calculating normalized weights shown in eq. (\ref{eq: normalized_weights}).
Fig. ~\ref{F:NormalizedWeights} shows these weights at a single pixel located at (0 m,0 m,-75 m). These decay away from the center pixel because of the decay of the sensitivity functions.
Because those are weights used to compute $w^e(t)$, we could expect that the computed $w^e(t)$ will be mostly affected by $\hat{w}_k$ from a few stations close to the center. In Fig. ~\ref{F:AveragedWe}, we provide both $\hat{w}_k$ (dashed lines) from all transmitter locations and $w^e(t)$ (solid line) averaged by them. The $w^e(t)$ is dominantly affected by the $\hat{w}(t)$ at the center transmitter location (solid circles)). Considering that the transmitters are 50 m apart, the  decay of the sensitivity from center transmitter location to others is substantial ($\sim 1/r^3$). This results in the greatest normalized weight at the center transmitter location, and the observed result about $w^e(t)$ is caused by this. $w^e(t)$ is convolved  with  $\peta^I(t)$ to compute the effective $\peta(t)$ for that cell. When this is carried out for each cell then the approximate IP responses can be computed using eq. (\ref{eq: dIP_lineareq}). These can be compared with the true IP responses.
Fig. ~\ref{F:EquivPeta_True_Approx} shows the comparisons at 0.86 ms. The images are nearly identical in shape but the approximate IP responses are nearly a factor of two lower than the true values. This is not entirely unexpected. A similar effect was observed for IP responses for a single transmitter shown in Fig. ~\ref{F:True_vs_approx_IPresp}. At 0.86 ms, the approximate value was about 70 percent of the true $\dip$. These results seem to be a worst case scenario. The discrepancy for a conductive body lessens as time increases and analyses for the canonical and resistive bodies shows that the approximate and true IP data are in very good agreement.

%% ============================================================
%% SUBSECTION
\section{Extracting intrinsic IP parameters}
\label{section: extract_intrinsicIP}
The output of our IP inversion is a 3D distribution of the pseudo-chargeability at multiple time channels.
As its name suggests, pseudo-chargeability is not an intrinsic IP parameter like chargeability, but it is a convoluted property between $\peta^{I}(t)$ and $\hat{w}(t)$:
\begin{linenomath*}
\begin{equation}
  \peta(t) = \peta^{I}(t) \otimes \hat{w}(t),
  \label{eq: pseudochargeability_petaI}
\end{equation}
\end{linenomath*}
with the definition of impulse pseudo-chargeability (eq. \ref{eq: intrinsic_peta}).
We now use the $\peta(t)$ as the “data” and recover intrinsic parameters such as $\eta, \tau, c$ in a Cole-Cole model. Assuming a Debye model ($c$=1), we obtain
\begin{linenomath*}
\begin{equation}
    \peta^{I}(t) = \frac{\eta}{(1-\eta)\tau}e^{-\frac{t}{(1-\eta)\tau}},
    \label{eq: intrinsic_peta_debye}
\end{equation}
\end{linenomath*}
Since we have $\siginf$ we can compute $\hat{w}(t)$, which is the time history of the electric field.
Accordingly, we can unravel the recovered pseudo-chargeability to extract intrinsic IP parameters such as chargeability($\eta$) and time constant ($\tau$).
We use a gradient-based optimization and thus we need the sensitivity function for the pseudo-chargeability (eq. \ref{eq: pseudochargeability_petaI}) with respect to $\eta$ and $\tau$.
To simplify this procedure, we rewrite impulse pseudo-chargeability as
\begin{linenomath*}
\begin{equation}
  \peta^{I}(t) = a e^{-bt},
\end{equation}
\end{linenomath*}
where $a = \frac{\eta}{(1-\eta)\tau}$ and $b = \frac{1}{(1-\eta)\tau}$.
Then we take the derivative of $\peta(t)$ with regard to $a$ and $b$:
\begin{linenomath*}
\begin{equation}
  \frac{\partial \peta(t)}{\partial a} = e^{-bt} \otimes \hat{w}(t),
\end{equation}
\end{linenomath*}
\begin{linenomath*}
\begin{equation}
  \frac{\partial \peta(t)}{\partial b} = -ate^{-bt} \otimes \hat{w}(t).
\end{equation}
\end{linenomath*}
With these sensitivity functions, we can set up an inverse problem, and recover $a$ and $b$.
The chargeability and time constant can be obtained from $a$ and $b$:
\begin{linenomath*}
\begin{equation}
  \eta =  \frac{a}{b},
\end{equation}
\end{linenomath*}
\begin{linenomath*}
\begin{equation}
  \tau =  \frac{1}{(1-a/b)b}.
\end{equation}
\end{linenomath*}
We apply this inversion separately to each cell in the recovered pseudo-chargeability  in a manner similar to \cite[]{Yuval1997}.
For the better alternative (representation) of time-dependent conductivity, a different parameterization such as stretched-exponential \cite[]{Kohlrausch1854} or Cole-Cole model with variable $c$ can be implemented.

%% ============================================================
\section{Discretizations}
\subsection{Steady-state Maxwell's equations}
\label{section:maxwell_discrete}
As shown in eq. (\ref{eq: phiIPapprox_general}), computation of our linearized kernel requires solving steady-state Maxwell's equations.
We discretize this system using a mimetic finite volume (FV) method with weak formulation \cite[]{Yee1966,Eldadbook}.
For the discretization, we assume that the electric field $\e$ is discretized by a grid function $\de$ on cell edges and the magnetic flux density $\b$ is discretized by agrid function $\db$ on cell faces.
The electrical potential $\phi$ is discretized by a grid function  $\phi$ on the cell nodes. For a clear representation of the derivation, recall Maxwell's equations in steady state are
\begin{align}
  \j = \siginf\e = -\siginf\grad \phi, \\
  -\div \j = \div \j_s, \\
  \j\big|_{\partial \Omega}\cdot\hat{n} = 0,
  \label{eq:DCBCneumann}
\end{align}
where $\partial \Omega$ indicates boundary surface of the system and $\hat{n}$ is the normal vector of the boundary surface. The weak form of those equations  can be written as
\begin{align}
  (\j, \vec{w}) + (\siginf \grad \phi, \vec{w}) = 0, \\
  -(\j, \grad \psi) = (\j_s, \grad \psi).
\end{align}
The inner products $(\j, \vec{w})$, $(\siginf \grad \phi, \vec{w})$,  $(\j, \grad \psi)$ and $(\j_s, \grad \psi)$ are edge-based products. Here we define the inner product as
\begin{linenomath*}
\begin{equation}
  (\vec{a}, \vec{b}) = \int_{\Omega} \vec{a}\cdot\vec{b} dv,
\end{equation}
\end{linenomath*}
where $\Omega$ is the volume of the system. By discretizing the $\grad$ operator and the inner product in space, we obtain
\begin{linenomath*}
\begin{equation}
  \Me\dj + \MeSigInf\dgrad\boldsymbol{\phi} = 0,
  \label{eq:DCdisceq1}
\end{equation}
\end{linenomath*}
\begin{linenomath*}
\begin{equation}
  -\dgrad^T \Me\dj = \dgrad^T \Me\dj_s,
  \label{eq:DCdisceq2}
\end{equation}
\end{linenomath*}
where $\mathbf{M}^e$ performs volume averaging, and $\mathbf{M}^e_{\siginf}$ is the mass matrix of conductivity ($\siginf$), which discretizes the edge based inner product.
For further details on the formation of this matrix see \cite{Eldadbook}.
% \begin{align}
%   \mathbf{M}^e_i = \diag(\Ace^T\diag(\vol)\mathbf{i}).
% \end{align}
% Here, $\mathbf{i}$ indicates a grid function on cell center like $\siginf$, and $\vol$ is the grid function for the cell volume. The averaging matrix $\Ace$ averages discrete function defined on the edges to the cell center. The mass matrix $\Me$ without subscript $i$ indicates that $\mathbf{i}$ is equal to the identity column vector of which all elements are one.

By substituting eq. (\ref{eq:DCdisceq1}) into (\ref{eq:DCdisceq2}), we have
\begin{linenomath*}
\begin{equation}
  \A_{\siginf}\boldsymbol{\phi} = \mathbf{rhs}^{DC},
  \label{eq:DCdiscLin}
\end{equation}
\end{linenomath*}
where $\A_{\siginf} = \dgrad^T \MeSigInf\dgrad$ and $\mathbf{rhs}^{DC} = \dgrad^T \Me\dj_s$. We use \SimPEG's tensor mesh and solver classes to form and solve above linear system \cite[]{Cockett2015}.

%% ===========================================================================
%% SUBSECTION
\subsection{Linearized kernel for IP responses}
\label{section:linearkernel_discrete}
To obtain a linear form of  eq. (\ref{eq: dIP_lineareq}),
we first discretize  the Biot-Savart law shown in eqs (\ref{eq: BiotbIP_approx}) and (\ref{eq: BiotbIPdt_approx}). In our discretization $\j^{IP}$ and  $\peta$ are defined at the cell centers, and those for each time channel are constant in a cell volume, whereas $\eref$ is defined on the cell edges.
We define the number of cells and edges in 3D space as $nC$ and $nE$, respectively. The discretized IP current density, $\dj^{IP}_{cc} \in \mathbb{R}^{3nC}_{1}$, is defined at the cell center. Since $\j^{IP}$ has three components, we first discretize the integration operator including cross product ($\int_{v}\frac{ \times \hat{r}}{r^2}dv$) as
\begin{linenomath*}
\begin{equation}
  \mathbf{G}_{Biot} =
  \begin{bmatrix}
       \mathbf{e}^T &  \mathbf{0}   & \mathbf{0}  \\
       \mathbf{0}   &  \mathbf{e}^T & \mathbf{0}  \\
       \mathbf{0}   &  \mathbf{0}   & \mathbf{e}^T
    \end{bmatrix}
  \begin{bmatrix}
       \mathbf{0}     &   \mathbf{S}_z   & -\mathbf{S}_y  \\
      -\mathbf{S}_z   &   \mathbf{0}     &  \mathbf{S}_x  \\
       \mathbf{S}_y   &  -\mathbf{S}_x   &  \mathbf{0}
    \end{bmatrix},
\end{equation}
\end{linenomath*}
where
\begin{linenomath*}
\begin{equation*}
  \mathbf{S}_l =\diag(\mathbf{v}\oplus \mathbf{r}_l \oplus \frac{1}{\mathbf{r}^2}), \ l = x, \ y, \ z
\end{equation*}
\end{linenomath*}
and the electric field, $\mathbf{e} \in \mathbb{R}^{nE}_1$ is a column vector, $\diag(\cdot)$ is the diagonal matrix and $\oplus$ is the Hadamard product.
Then we discretize $\j^{IP}$ shown in eq. (\ref{eq: jip_approx}) as
\begin{linenomath*}
\begin{equation}
  \dj^{IP}_{cc}(t) = \mathbf{S}\diag(\de^{F}_{max})\Ace^T\diag(\vol)\diag(\siginf)\peta(t),
\end{equation}
\end{linenomath*}
where $\mathbf{A}^{e}_{c}$ is a discrete averaging matrix from edge to cell center and
\begin{linenomath*}
\begin{equation}
  \mathbf{S} = \mathbf{A}^{e}_{ccv}\Me^{-1}[\MeSigInf \mathbf{G} \A_{\siginf}^{-1}\mathbf{G}^T  - \mathbf{I}] \diag(\de^{F}_{max})\Ace^T\diag(\vol)\diag(\siginf).
\end{equation}
\end{linenomath*}
Here $\mathbf{A}^{e}_{ccv}$ is a discrete averaging matrix from edge to cell center with consideration of three component vector: $\in \mathbb{R}^{3nC}_{nE}$.
Thus, we can have a linear equation for a single time channel as
\begin{linenomath*}
\begin{equation*}
  \db^{IP} = \Gbiot \mathbf{S} \peta,
\end{equation*}
\end{linenomath*}
Finally, by letting
\begin{linenomath*}
\begin{equation}
  \mathbf{J} = \Gbiot\mathbf{S},
  \label{eq: Sense}
\end{equation}
\end{linenomath*}
we have
\begin{linenomath*}
\begin{equation}
  \db^{IP} = \mathbf{J}\peta,
  \label{eq: bIP_linear}
\end{equation}
\end{linenomath*}
where $\mathbf{J}$ is the Jacobian matrix of the linear equation, and since $\mathbf{J}$ is static, we also obtain
\begin{linenomath*}
\begin{equation}
  -\frac{\partial\db^{IP}}{\partial t}\Big| = \mathbf{J}(-\frac{\partial \peta}{\partial t}\Big|).
  \label{eq: dbIPdt_linear}
\end{equation}
\end{linenomath*}

\clearpage

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/NormalizedWeights.png} }
  \caption{Normalized weights for the conductive case for all transmitter locations. A single pixel located at (0 m, 0 m, -75 m) is used. }
  \label{F:NormalizedWeights}
\end{figure}

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/AveragedWe.png} }
  \caption{Time decays of $w^e(t)$ and $\hat{w}(t)$ for the conductive case. A single pixel located at (0 m, 0 m, -75 m) is used. Solid line and dashed lines correspond to $w^e(t)$ and $\hat{w}_k(t)$ for all transmitters ($k=1,\ \ldots,\ nTx$); $\hat{w}_k$ at the center transmitter located at (0 m, 0 m, 30 m) is marked as solid circles. A number of $w^e(t)$ curves are overlaid due to the symmetric position of transmitter locations to the conductive block. }
  \label{F:AveragedWe}
\end{figure}
\clearpage

\begin{figure}
  \figbox*{}{}{
  \includegraphics[width=1.\textwidth]{figures/EquivPeta_True_Approx.png} }
  \caption{Comparison of true and approximate $b_z^{IP}$ responses at 0.86 ms on plan view map. }
  \label{F:EquivPeta_True_Approx}
\end{figure}
\clearpage
\end{document}

